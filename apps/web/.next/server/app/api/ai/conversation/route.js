(()=>{var a={};a.id=410,a.ids=[410],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},1708:a=>{"use strict";a.exports=require("node:process")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4537:(a,b,c)=>{"use strict";c.d(b,{Y:()=>ce});let d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol:a=>`Symbol(${a})`;function e(){}function f(a){return"object"==typeof a&&null!==a||"function"==typeof a}function g(a,b){try{Object.defineProperty(a,"name",{value:b,configurable:!0})}catch(a){}}let h=Promise,i=Promise.prototype.then,j=Promise.resolve.bind(h),k=Promise.reject.bind(h);function l(a){return new h(a)}function m(a,b,c){return i.call(a,b,c)}function n(a,b,c){m(m(a,b,c),void 0,e)}function o(a){m(a,void 0,e)}let p=a=>{if("function"==typeof queueMicrotask)p=queueMicrotask;else{let a=j(void 0);p=b=>m(a,b)}return p(a)};function q(a,b,c){if("function"!=typeof a)throw TypeError("Argument is not a function");return Function.prototype.apply.call(a,b,c)}function r(a,b,c){try{var d;return d=q(a,b,c),j(d)}catch(a){return k(a)}}class s{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(a){let b=this._back,c=b;16383===b._elements.length&&(c={_elements:[],_next:void 0}),b._elements.push(a),c!==b&&(this._back=c,b._next=c),++this._size}shift(){let a=this._front,b=a,c=this._cursor,d=c+1,e=a._elements,f=e[c];return 16384===d&&(b=a._next,d=0),--this._size,this._cursor=d,a!==b&&(this._front=b),e[c]=void 0,f}forEach(a){let b=this._cursor,c=this._front,d=c._elements;for(;!(b===d.length&&void 0===c._next||b===d.length&&(d=(c=c._next)._elements,b=0,0===d.length));)a(d[b]),++b}peek(){let a=this._front,b=this._cursor;return a._elements[b]}}let t=d("[[AbortSteps]]"),u=d("[[ErrorSteps]]"),v=d("[[CancelSteps]]"),w=d("[[PullSteps]]"),x=d("[[ReleaseSteps]]");function y(a,b){var c,d;a._ownerReadableStream=b,b._reader=a,"readable"===b._state?C(a):"closed"===b._state?(C(a),E(a)):(c=a,d=b._storedError,C(c),D(c,d))}function z(a,b){return bA(a._ownerReadableStream,b)}function A(a){var b,c;let d=a._ownerReadableStream;"readable"===d._state?D(a,TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):(b=a,c=TypeError("Reader was released and can no longer be used to monitor the stream's closedness"),C(b),D(b,c)),d._readableStreamController[x](),d._reader=void 0,a._ownerReadableStream=void 0}function B(a){return TypeError("Cannot "+a+" a stream using a released reader")}function C(a){a._closedPromise=l((b,c)=>{a._closedPromise_resolve=b,a._closedPromise_reject=c})}function D(a,b){void 0!==a._closedPromise_reject&&(o(a._closedPromise),a._closedPromise_reject(b),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0)}function E(a){void 0!==a._closedPromise_resolve&&(a._closedPromise_resolve(void 0),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0)}let F=Number.isFinite||function(a){return"number"==typeof a&&isFinite(a)},G=Math.trunc||function(a){return a<0?Math.ceil(a):Math.floor(a)};function H(a,b){if(void 0!==a&&"object"!=typeof a&&"function"!=typeof a)throw TypeError(`${b} is not an object.`)}function I(a,b){if("function"!=typeof a)throw TypeError(`${b} is not a function.`)}function J(a,b){if(("object"!=typeof a||null===a)&&"function"!=typeof a)throw TypeError(`${b} is not an object.`)}function K(a,b,c){if(void 0===a)throw TypeError(`Parameter ${b} is required in '${c}'.`)}function L(a,b,c){if(void 0===a)throw TypeError(`${b} is required in '${c}'.`)}function M(a){return Number(a)}function N(a,b){var c,d;let e=Number.MAX_SAFE_INTEGER,f=Number(a);if(!F(f=0===(c=f)?0:c))throw TypeError(`${b} is not a finite number`);if((f=0===(d=G(f))?0:d)<0||f>e)throw TypeError(`${b} is outside the accepted range of 0 to ${e}, inclusive`);return F(f)&&0!==f?f:0}function O(a){if(!f(a)||"function"!=typeof a.getReader)return!1;try{return"boolean"==typeof a.locked}catch(a){return!1}}function P(a){if(!f(a)||"function"!=typeof a.getWriter)return!1;try{return"boolean"==typeof a.locked}catch(a){return!1}}function Q(a,b){if(!by(a))throw TypeError(`${b} is not a ReadableStream.`)}function R(a,b){a._reader._readRequests.push(b)}function S(a,b,c){let d=a._reader._readRequests.shift();c?d._closeSteps():d._chunkSteps(b)}function T(a){return a._reader._readRequests.length}function U(a){let b=a._reader;return void 0!==b&&!!W(b)}class V{constructor(a){if(K(a,1,"ReadableStreamDefaultReader"),Q(a,"First parameter"),bz(a))throw TypeError("This stream has already been locked for exclusive reading by another reader");y(this,a),this._readRequests=new s}get closed(){return W(this)?this._closedPromise:k(Y("closed"))}cancel(a){return W(this)?void 0===this._ownerReadableStream?k(B("cancel")):z(this,a):k(Y("cancel"))}read(){let a,b;if(!W(this))return k(Y("read"));if(void 0===this._ownerReadableStream)return k(B("read from"));let c=l((c,d)=>{a=c,b=d});return function(a,b){let c=a._ownerReadableStream;c._disturbed=!0,"closed"===c._state?b._closeSteps():"errored"===c._state?b._errorSteps(c._storedError):c._readableStreamController[w](b)}(this,{_chunkSteps:b=>a({value:b,done:!1}),_closeSteps:()=>a({value:void 0,done:!0}),_errorSteps:a=>b(a)}),c}releaseLock(){if(!W(this))throw Y("releaseLock");void 0!==this._ownerReadableStream&&(A(this),X(this,TypeError("Reader was released")))}}function W(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_readRequests")&&a instanceof V}function X(a,b){let c=a._readRequests;a._readRequests=new s,c.forEach(a=>{a._errorSteps(b)})}function Y(a){return TypeError(`ReadableStreamDefaultReader.prototype.${a} can only be used on a ReadableStreamDefaultReader`)}Object.defineProperties(V.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),g(V.prototype.cancel,"cancel"),g(V.prototype.read,"read"),g(V.prototype.releaseLock,"releaseLock"),"symbol"==typeof d.toStringTag&&Object.defineProperty(V.prototype,d.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});class Z{constructor(a,b){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=a,this._preventCancel=b}next(){let a=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?m(this._ongoingPromise,a,a):a(),this._ongoingPromise}return(a){let b=()=>this._returnSteps(a);return this._ongoingPromise?m(this._ongoingPromise,b,b):b()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let a=this._reader;return void 0===a?k(B("iterate")):m(a.read(),a=>{var b;return this._ongoingPromise=void 0,a.done&&(this._isFinished=!0,null==(b=this._reader)||b.releaseLock(),this._reader=void 0),a},a=>{var b;throw this._ongoingPromise=void 0,this._isFinished=!0,null==(b=this._reader)||b.releaseLock(),this._reader=void 0,a})}_returnSteps(a){if(this._isFinished)return Promise.resolve({value:a,done:!0});this._isFinished=!0;let b=this._reader;if(void 0===b)return k(B("finish iterating"));if(this._reader=void 0,!this._preventCancel){let c=b.cancel(a);return b.releaseLock(),m(c,()=>({value:a,done:!0}),void 0)}return b.releaseLock(),j({value:a,done:!0})}}let $={next(){return _(this)?this._asyncIteratorImpl.next():k(aa("next"))},return(a){return _(this)?this._asyncIteratorImpl.return(a):k(aa("return"))}};function _(a){if(!f(a)||!Object.prototype.hasOwnProperty.call(a,"_asyncIteratorImpl"))return!1;try{return a._asyncIteratorImpl instanceof Z}catch(a){return!1}}function aa(a){return TypeError(`ReadableStreamAsyncIterator.${a} can only be used on a ReadableSteamAsyncIterator`)}"symbol"==typeof d.asyncIterator&&Object.defineProperty($,d.asyncIterator,{value(){return this},writable:!0,configurable:!0});let ab=Number.isNaN||function(a){return a!=a};function ac(a,b,c,d,e){new Uint8Array(a).set(new Uint8Array(c,d,e),b)}function ad(a){return new Uint8Array(function(a,b,c){if(a.slice)return a.slice(b,c);let d=c-b,e=new ArrayBuffer(d);return ac(e,0,a,b,d),e}(a.buffer,a.byteOffset,a.byteOffset+a.byteLength))}function ae(a){let b=a._queue.shift();return a._queueTotalSize-=b.size,a._queueTotalSize<0&&(a._queueTotalSize=0),b.value}function af(a,b,c){if("number"!=typeof c||ab(c)||c<0||c===1/0)throw RangeError("Size must be a finite, non-NaN, non-negative number.");a._queue.push({value:b,size:c}),a._queueTotalSize+=c}function ag(a){a._queue=new s,a._queueTotalSize=0}class ah{constructor(){throw TypeError("Illegal constructor")}get view(){if(!ak(this))throw aD("view");return this._view}respond(a){if(!ak(this))throw aD("respond");if(K(a,1,"respond"),a=N(a,"First parameter"),void 0===this._associatedReadableByteStreamController)throw TypeError("This BYOB request has been invalidated");this._view.buffer,function(a,b){let c=a._pendingPullIntos.peek();if("closed"===a._controlledReadableByteStream._state){if(0!==b)throw TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(0===b)throw TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(c.bytesFilled+b>c.byteLength)throw RangeError("bytesWritten out of range")}c.buffer=c.buffer,ax(a,b)}(this._associatedReadableByteStreamController,a)}respondWithNewView(a){if(!ak(this))throw aD("respondWithNewView");if(K(a,1,"respondWithNewView"),!ArrayBuffer.isView(a))throw TypeError("You can only respond with array buffer views");if(void 0===this._associatedReadableByteStreamController)throw TypeError("This BYOB request has been invalidated");a.buffer,function(a,b){let c=a._pendingPullIntos.peek();if("closed"===a._controlledReadableByteStream._state){if(0!==b.byteLength)throw TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(0===b.byteLength)throw TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(c.byteOffset+c.bytesFilled!==b.byteOffset)throw RangeError("The region specified by view does not match byobRequest");if(c.bufferByteLength!==b.buffer.byteLength)throw RangeError("The buffer of view has different capacity than byobRequest");if(c.bytesFilled+b.byteLength>c.byteLength)throw RangeError("The region specified by view is larger than byobRequest");let d=b.byteLength;c.buffer=b.buffer,ax(a,d)}(this._associatedReadableByteStreamController,a)}}Object.defineProperties(ah.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),g(ah.prototype.respond,"respond"),g(ah.prototype.respondWithNewView,"respondWithNewView"),"symbol"==typeof d.toStringTag&&Object.defineProperty(ah.prototype,d.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class ai{constructor(){throw TypeError("Illegal constructor")}get byobRequest(){if(!aj(this))throw aE("byobRequest");return function(a){if(null===a._byobRequest&&a._pendingPullIntos.length>0){let b=a._pendingPullIntos.peek(),c=new Uint8Array(b.buffer,b.byteOffset+b.bytesFilled,b.byteLength-b.bytesFilled),d=Object.create(ah.prototype);d._associatedReadableByteStreamController=a,d._view=c,a._byobRequest=d}return a._byobRequest}(this)}get desiredSize(){if(!aj(this))throw aE("desiredSize");return aC(this)}close(){if(!aj(this))throw aE("close");if(this._closeRequested)throw TypeError("The stream has already been closed; do not close it again!");let a=this._controlledReadableByteStream._state;if("readable"!==a)throw TypeError(`The stream (in ${a} state) is not in the readable state and cannot be closed`);!function(a){let b=a._controlledReadableByteStream;if(!a._closeRequested&&"readable"===b._state){if(a._queueTotalSize>0)return a._closeRequested=!0;if(a._pendingPullIntos.length>0&&a._pendingPullIntos.peek().bytesFilled>0){let b=TypeError("Insufficient bytes to fill elements in the given buffer");throw aA(a,b),b}az(a),bB(b)}}(this)}enqueue(a){if(!aj(this))throw aE("enqueue");if(K(a,1,"enqueue"),!ArrayBuffer.isView(a))throw TypeError("chunk must be an array buffer view");if(0===a.byteLength)throw TypeError("chunk must have non-zero byteLength");if(0===a.buffer.byteLength)throw TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw TypeError("stream is closed or draining");let b=this._controlledReadableByteStream._state;if("readable"!==b)throw TypeError(`The stream (in ${b} state) is not in the readable state and cannot be enqueued to`);!function(a,b){let c=a._controlledReadableByteStream;if(a._closeRequested||"readable"!==c._state)return;let d=b.buffer,e=b.byteOffset,f=b.byteLength;if(a._pendingPullIntos.length>0){let b=a._pendingPullIntos.peek();b.buffer,av(a),b.buffer=b.buffer,"none"===b.readerType&&ar(a,b)}U(c)?(function(a){let b=a._controlledReadableByteStream._reader;for(;b._readRequests.length>0;){if(0===a._queueTotalSize)return;aB(a,b._readRequests.shift())}}(a),0===T(c))?ap(a,d,e,f):(a._pendingPullIntos.length>0&&ay(a),S(c,new Uint8Array(d,e,f),!1)):aH(c)?(ap(a,d,e,f),aw(a)):ap(a,d,e,f),al(a)}(this,a)}error(a){if(!aj(this))throw aE("error");aA(this,a)}[v](a){am(this),ag(this);let b=this._cancelAlgorithm(a);return az(this),b}[w](a){let b=this._controlledReadableByteStream;if(this._queueTotalSize>0)return void aB(this,a);let c=this._autoAllocateChunkSize;if(void 0!==c){let b;try{b=new ArrayBuffer(c)}catch(b){return void a._errorSteps(b)}let d={buffer:b,bufferByteLength:c,byteOffset:0,byteLength:c,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(d)}R(b,a),al(this)}[x](){if(this._pendingPullIntos.length>0){let a=this._pendingPullIntos.peek();a.readerType="none",this._pendingPullIntos=new s,this._pendingPullIntos.push(a)}}}function aj(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_controlledReadableByteStream")&&a instanceof ai}function ak(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_associatedReadableByteStreamController")&&a instanceof ah}function al(a){if(function(a){let b=a._controlledReadableByteStream;return"readable"===b._state&&!a._closeRequested&&!!a._started&&!!(U(b)&&T(b)>0||aH(b)&&aG(b)>0||aC(a)>0)}(a)){if(a._pulling)return void(a._pullAgain=!0);a._pulling=!0,n(a._pullAlgorithm(),()=>(a._pulling=!1,a._pullAgain&&(a._pullAgain=!1,al(a)),null),b=>(aA(a,b),null))}}function am(a){av(a),a._pendingPullIntos=new s}function an(a,b){let c=!1;"closed"===a._state&&(c=!0);let d=ao(b);"default"===b.readerType?S(a,d,c):function(a,b,c){let d=a._reader._readIntoRequests.shift();c?d._closeSteps(b):d._chunkSteps(b)}(a,d,c)}function ao(a){let b=a.bytesFilled,c=a.elementSize;return new a.viewConstructor(a.buffer,a.byteOffset,b/c)}function ap(a,b,c,d){a._queue.push({buffer:b,byteOffset:c,byteLength:d}),a._queueTotalSize+=d}function aq(a,b,c,d){let e;try{e=b.slice(c,c+d)}catch(b){throw aA(a,b),b}ap(a,e,0,d)}function ar(a,b){b.bytesFilled>0&&aq(a,b.buffer,b.byteOffset,b.bytesFilled),ay(a)}function as(a,b){let c=b.elementSize,d=b.bytesFilled-b.bytesFilled%c,e=Math.min(a._queueTotalSize,b.byteLength-b.bytesFilled),f=b.bytesFilled+e,g=f-f%c,h=e,i=!1;g>d&&(h=g-b.bytesFilled,i=!0);let j=a._queue;for(;h>0;){let c=j.peek(),d=Math.min(h,c.byteLength),e=b.byteOffset+b.bytesFilled;ac(b.buffer,e,c.buffer,c.byteOffset,d),c.byteLength===d?j.shift():(c.byteOffset+=d,c.byteLength-=d),a._queueTotalSize-=d,at(a,d,b),h-=d}return i}function at(a,b,c){c.bytesFilled+=b}function au(a){0===a._queueTotalSize&&a._closeRequested?(az(a),bB(a._controlledReadableByteStream)):al(a)}function av(a){null!==a._byobRequest&&(a._byobRequest._associatedReadableByteStreamController=void 0,a._byobRequest._view=null,a._byobRequest=null)}function aw(a){for(;a._pendingPullIntos.length>0;){if(0===a._queueTotalSize)return;let b=a._pendingPullIntos.peek();as(a,b)&&(ay(a),an(a._controlledReadableByteStream,b))}}function ax(a,b){let c=a._pendingPullIntos.peek();av(a),"closed"===a._controlledReadableByteStream._state?function(a,b){"none"===b.readerType&&ay(a);let c=a._controlledReadableByteStream;if(aH(c))for(;aG(c)>0;)an(c,ay(a))}(a,c):function(a,b,c){if(at(0,b,c),"none"===c.readerType)return ar(a,c),aw(a);if(c.bytesFilled<c.elementSize)return;ay(a);let d=c.bytesFilled%c.elementSize;if(d>0){let b=c.byteOffset+c.bytesFilled;aq(a,c.buffer,b-d,d)}c.bytesFilled-=d,an(a._controlledReadableByteStream,c),aw(a)}(a,b,c),al(a)}function ay(a){return a._pendingPullIntos.shift()}function az(a){a._pullAlgorithm=void 0,a._cancelAlgorithm=void 0}function aA(a,b){let c=a._controlledReadableByteStream;"readable"===c._state&&(am(a),ag(a),az(a),bC(c,b))}function aB(a,b){let c=a._queue.shift();a._queueTotalSize-=c.byteLength,au(a);let d=new Uint8Array(c.buffer,c.byteOffset,c.byteLength);b._chunkSteps(d)}function aC(a){let b=a._controlledReadableByteStream._state;return"errored"===b?null:"closed"===b?0:a._strategyHWM-a._queueTotalSize}function aD(a){return TypeError(`ReadableStreamBYOBRequest.prototype.${a} can only be used on a ReadableStreamBYOBRequest`)}function aE(a){return TypeError(`ReadableByteStreamController.prototype.${a} can only be used on a ReadableByteStreamController`)}function aF(a,b){a._reader._readIntoRequests.push(b)}function aG(a){return a._reader._readIntoRequests.length}function aH(a){let b=a._reader;return void 0!==b&&!!aJ(b)}Object.defineProperties(ai.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),g(ai.prototype.close,"close"),g(ai.prototype.enqueue,"enqueue"),g(ai.prototype.error,"error"),"symbol"==typeof d.toStringTag&&Object.defineProperty(ai.prototype,d.toStringTag,{value:"ReadableByteStreamController",configurable:!0});class aI{constructor(a){if(K(a,1,"ReadableStreamBYOBReader"),Q(a,"First parameter"),bz(a))throw TypeError("This stream has already been locked for exclusive reading by another reader");if(!aj(a._readableStreamController))throw TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");y(this,a),this._readIntoRequests=new s}get closed(){return aJ(this)?this._closedPromise:k(aL("closed"))}cancel(a){return aJ(this)?void 0===this._ownerReadableStream?k(B("cancel")):z(this,a):k(aL("cancel"))}read(a){let b,c;if(!aJ(this))return k(aL("read"));if(!ArrayBuffer.isView(a))return k(TypeError("view must be an array buffer view"));if(0===a.byteLength)return k(TypeError("view must have non-zero byteLength"));if(0===a.buffer.byteLength)return k(TypeError("view's buffer must have non-zero byteLength"));if(a.buffer,void 0===this._ownerReadableStream)return k(B("read from"));let d=l((a,d)=>{b=a,c=d});return function(a,b,c){let d=a._ownerReadableStream;d._disturbed=!0,"errored"===d._state?c._errorSteps(d._storedError):function(a,b,c){let d=a._controlledReadableByteStream,e=1;b.constructor!==DataView&&(e=b.constructor.BYTES_PER_ELEMENT);let f=b.constructor,g=b.buffer,h={buffer:g,bufferByteLength:g.byteLength,byteOffset:b.byteOffset,byteLength:b.byteLength,bytesFilled:0,elementSize:e,viewConstructor:f,readerType:"byob"};if(a._pendingPullIntos.length>0)return a._pendingPullIntos.push(h),aF(d,c);if("closed"!==d._state){if(a._queueTotalSize>0){if(as(a,h)){let b=ao(h);return au(a),c._chunkSteps(b)}if(a._closeRequested){let b=TypeError("Insufficient bytes to fill elements in the given buffer");return aA(a,b),c._errorSteps(b)}}a._pendingPullIntos.push(h),aF(d,c),al(a)}else{let a=new f(h.buffer,h.byteOffset,0);c._closeSteps(a)}}(d._readableStreamController,b,c)}(this,a,{_chunkSteps:a=>b({value:a,done:!1}),_closeSteps:a=>b({value:a,done:!0}),_errorSteps:a=>c(a)}),d}releaseLock(){if(!aJ(this))throw aL("releaseLock");void 0!==this._ownerReadableStream&&(A(this),aK(this,TypeError("Reader was released")))}}function aJ(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_readIntoRequests")&&a instanceof aI}function aK(a,b){let c=a._readIntoRequests;a._readIntoRequests=new s,c.forEach(a=>{a._errorSteps(b)})}function aL(a){return TypeError(`ReadableStreamBYOBReader.prototype.${a} can only be used on a ReadableStreamBYOBReader`)}function aM(a,b){let{highWaterMark:c}=a;if(void 0===c)return b;if(ab(c)||c<0)throw RangeError("Invalid highWaterMark");return c}function aN(a){let{size:b}=a;return b||(()=>1)}function aO(a,b){var c;H(a,b);let d=null==a?void 0:a.highWaterMark,e=null==a?void 0:a.size;return{highWaterMark:void 0===d?void 0:M(d),size:void 0===e?void 0:(I(c=e,`${b} has member 'size' that`),a=>M(c(a)))}}Object.defineProperties(aI.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),g(aI.prototype.cancel,"cancel"),g(aI.prototype.read,"read"),g(aI.prototype.releaseLock,"releaseLock"),"symbol"==typeof d.toStringTag&&Object.defineProperty(aI.prototype,d.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});let aP="function"==typeof AbortController;class aQ{constructor(a={},b={}){void 0===a?a=null:J(a,"First parameter");let c=aO(b,"Second parameter"),d=function(a,b){H(a,b);let c=null==a?void 0:a.abort,d=null==a?void 0:a.close,e=null==a?void 0:a.start,f=null==a?void 0:a.type,g=null==a?void 0:a.write;return{abort:void 0===c?void 0:(I(c,`${b} has member 'abort' that`),b=>r(c,a,[b])),close:void 0===d?void 0:(I(d,`${b} has member 'close' that`),()=>r(d,a,[])),start:void 0===e?void 0:(I(e,`${b} has member 'start' that`),b=>q(e,a,[b])),write:void 0===g?void 0:(I(g,`${b} has member 'write' that`),(b,c)=>r(g,a,[b,c])),type:f}}(a,"First parameter");if(this._state="writable",this._storedError=void 0,this._writer=void 0,this._writableStreamController=void 0,this._writeRequests=new s,this._inFlightWriteRequest=void 0,this._closeRequest=void 0,this._inFlightCloseRequest=void 0,this._pendingAbortRequest=void 0,this._backpressure=!1,void 0!==d.type)throw RangeError("Invalid type is specified");let e=aN(c);!function(a,b,c,d){let e,f,g,h,i=Object.create(a3.prototype);e=void 0!==b.start?()=>b.start(i):()=>{},f=void 0!==b.write?a=>b.write(a,i):()=>j(void 0),g=void 0!==b.close?()=>b.close():()=>j(void 0),h=void 0!==b.abort?a=>b.abort(a):()=>j(void 0),i._controlledWritableStream=a,a._writableStreamController=i,i._queue=void 0,i._queueTotalSize=void 0,ag(i),i._abortReason=void 0,i._abortController=function(){if(aP)return new AbortController}(),i._started=!1,i._strategySizeAlgorithm=d,i._strategyHWM=c,i._writeAlgorithm=f,i._closeAlgorithm=g,i._abortAlgorithm=h,a$(a,0>=a6(i)),n(j(e()),()=>(i._started=!0,a7(i),null),b=>(i._started=!0,aV(a,b),null))}(this,d,aM(c,1),e)}get locked(){if(!aR(this))throw ba("locked");return aS(this)}abort(a){return aR(this)?aS(this)?k(TypeError("Cannot abort a stream that already has a writer")):aT(this,a):k(ba("abort"))}close(){return aR(this)?aS(this)?k(TypeError("Cannot close a stream that already has a writer")):aY(this)?k(TypeError("Cannot close an already-closing stream")):aU(this):k(ba("close"))}getWriter(){if(!aR(this))throw ba("getWriter");return new a_(this)}}function aR(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_writableStreamController")&&a instanceof aQ}function aS(a){return void 0!==a._writer}function aT(a,b){var c;if("closed"===a._state||"errored"===a._state)return j(void 0);a._writableStreamController._abortReason=b,null==(c=a._writableStreamController._abortController)||c.abort(b);let d=a._state;if("closed"===d||"errored"===d)return j(void 0);if(void 0!==a._pendingAbortRequest)return a._pendingAbortRequest._promise;let e=!1;"erroring"===d&&(e=!0,b=void 0);let f=l((c,d)=>{a._pendingAbortRequest={_promise:void 0,_resolve:c,_reject:d,_reason:b,_wasAlreadyErroring:e}});return a._pendingAbortRequest._promise=f,e||aW(a,b),f}function aU(a){var b;let c=a._state;if("closed"===c||"errored"===c)return k(TypeError(`The stream (in ${c} state) is not in the writable state and cannot be closed`));let d=l((b,c)=>{a._closeRequest={_resolve:b,_reject:c}}),e=a._writer;return void 0!==e&&a._backpressure&&"writable"===c&&bk(e),af(b=a._writableStreamController,a2,0),a7(b),d}function aV(a,b){"writable"!==a._state?aX(a):aW(a,b)}function aW(a,b){let c=a._writableStreamController;a._state="erroring",a._storedError=b;let d=a._writer;void 0!==d&&a1(d,b),void 0===a._inFlightWriteRequest&&void 0===a._inFlightCloseRequest&&c._started&&aX(a)}function aX(a){a._state="errored",a._writableStreamController[u]();let b=a._storedError;if(a._writeRequests.forEach(a=>{a._reject(b)}),a._writeRequests=new s,void 0===a._pendingAbortRequest)return void aZ(a);let c=a._pendingAbortRequest;if(a._pendingAbortRequest=void 0,c._wasAlreadyErroring)return c._reject(b),void aZ(a);n(a._writableStreamController[t](c._reason),()=>(c._resolve(),aZ(a),null),b=>(c._reject(b),aZ(a),null))}function aY(a){return void 0!==a._closeRequest||void 0!==a._inFlightCloseRequest}function aZ(a){void 0!==a._closeRequest&&(a._closeRequest._reject(a._storedError),a._closeRequest=void 0);let b=a._writer;void 0!==b&&bf(b,a._storedError)}function a$(a,b){let c=a._writer;void 0!==c&&b!==a._backpressure&&(b?bh(c):bk(c)),a._backpressure=b}Object.defineProperties(aQ.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),g(aQ.prototype.abort,"abort"),g(aQ.prototype.close,"close"),g(aQ.prototype.getWriter,"getWriter"),"symbol"==typeof d.toStringTag&&Object.defineProperty(aQ.prototype,d.toStringTag,{value:"WritableStream",configurable:!0});class a_{constructor(a){if(K(a,1,"WritableStreamDefaultWriter"),function(a,b){if(!aR(a))throw TypeError(`${b} is not a WritableStream.`)}(a,"First parameter"),aS(a))throw TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=a,a._writer=this;let b=a._state;if("writable"===b)!aY(a)&&a._backpressure?bh(this):function(a){bh(a),bk(a)}(this),be(this);else if("erroring"===b)bi(this,a._storedError),be(this);else if("closed"===b)(function(a){bh(a),bk(a)})(this),be(this),bg(this);else{let b=a._storedError;bi(this,b),function(a,b){be(a),bf(a,b)}(this,b)}}get closed(){return a0(this)?this._closedPromise:k(bc("closed"))}get desiredSize(){if(!a0(this))throw bc("desiredSize");if(void 0===this._ownerWritableStream)throw bd("desiredSize");let a=this._ownerWritableStream,b=a._state;return"errored"===b||"erroring"===b?null:"closed"===b?0:a6(a._writableStreamController)}get ready(){return a0(this)?this._readyPromise:k(bc("ready"))}abort(a){return a0(this)?void 0===this._ownerWritableStream?k(bd("abort")):aT(this._ownerWritableStream,a):k(bc("abort"))}close(){if(!a0(this))return k(bc("close"));let a=this._ownerWritableStream;return void 0===a?k(bd("close")):aY(a)?k(TypeError("Cannot close an already-closing stream")):aU(this._ownerWritableStream)}releaseLock(){if(!a0(this))throw bc("releaseLock");void 0!==this._ownerWritableStream&&function(a){var b,c;let d=a._ownerWritableStream,e=TypeError("Writer was released and can no longer be used to monitor the stream's closedness");a1(a,e),"pending"===a._closedPromiseState?bf(a,e):(b=a,c=e,be(b),bf(b,c)),d._writer=void 0,a._ownerWritableStream=void 0}(this)}write(a){return a0(this)?void 0===this._ownerWritableStream?k(bd("write to")):function(a,b){let c=a._ownerWritableStream,d=c._writableStreamController,e=function(a,b){try{return a._strategySizeAlgorithm(b)}catch(b){return a8(a,b),1}}(d,b);if(c!==a._ownerWritableStream)return k(bd("write to"));let f=c._state;if("errored"===f)return k(c._storedError);if(aY(c)||"closed"===f)return k(TypeError("The stream is closing or closed and cannot be written to"));if("erroring"===f)return k(c._storedError);let g=l((a,b)=>{c._writeRequests.push({_resolve:a,_reject:b})});return function(a,b,c){try{af(a,b,c)}catch(b){return void a8(a,b)}let d=a._controlledWritableStream;aY(d)||"writable"!==d._state||a$(d,0>=a6(a)),a7(a)}(d,b,e),g}(this,a):k(bc("write"))}}function a0(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_ownerWritableStream")&&a instanceof a_}function a1(a,b){"pending"===a._readyPromiseState?bj(a,b):bi(a,b)}Object.defineProperties(a_.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),g(a_.prototype.abort,"abort"),g(a_.prototype.close,"close"),g(a_.prototype.releaseLock,"releaseLock"),g(a_.prototype.write,"write"),"symbol"==typeof d.toStringTag&&Object.defineProperty(a_.prototype,d.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});let a2={};class a3{constructor(){throw TypeError("Illegal constructor")}get abortReason(){if(!a4(this))throw bb("abortReason");return this._abortReason}get signal(){if(!a4(this))throw bb("signal");if(void 0===this._abortController)throw TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(a){if(!a4(this))throw bb("error");"writable"===this._controlledWritableStream._state&&a9(this,a)}[t](a){let b=this._abortAlgorithm(a);return a5(this),b}[u](){ag(this)}}function a4(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_controlledWritableStream")&&a instanceof a3}function a5(a){a._writeAlgorithm=void 0,a._closeAlgorithm=void 0,a._abortAlgorithm=void 0,a._strategySizeAlgorithm=void 0}function a6(a){return a._strategyHWM-a._queueTotalSize}function a7(a){let b=a._controlledWritableStream;if(!a._started||void 0!==b._inFlightWriteRequest)return;if("erroring"===b._state)return void aX(b);if(0===a._queue.length)return;let c=a._queue.peek().value;c===a2?function(a){let b=a._controlledWritableStream;b._inFlightCloseRequest=b._closeRequest,b._closeRequest=void 0,ae(a);let c=a._closeAlgorithm();a5(a),n(c,()=>((function(a){a._inFlightCloseRequest._resolve(void 0),a._inFlightCloseRequest=void 0,"erroring"===a._state&&(a._storedError=void 0,void 0!==a._pendingAbortRequest&&(a._pendingAbortRequest._resolve(),a._pendingAbortRequest=void 0)),a._state="closed";let b=a._writer;void 0!==b&&bg(b)})(b),null),a=>(b._inFlightCloseRequest._reject(a),b._inFlightCloseRequest=void 0,void 0!==b._pendingAbortRequest&&(b._pendingAbortRequest._reject(a),b._pendingAbortRequest=void 0),aV(b,a),null))}(a):function(a,b){let c=a._controlledWritableStream;c._inFlightWriteRequest=c._writeRequests.shift(),n(a._writeAlgorithm(b),()=>{c._inFlightWriteRequest._resolve(void 0),c._inFlightWriteRequest=void 0;let b=c._state;return ae(a),aY(c)||"writable"!==b||a$(c,0>=a6(a)),a7(a),null},b=>("writable"===c._state&&a5(a),c._inFlightWriteRequest._reject(b),c._inFlightWriteRequest=void 0,aV(c,b),null))}(a,c)}function a8(a,b){"writable"===a._controlledWritableStream._state&&a9(a,b)}function a9(a,b){let c=a._controlledWritableStream;a5(a),aW(c,b)}function ba(a){return TypeError(`WritableStream.prototype.${a} can only be used on a WritableStream`)}function bb(a){return TypeError(`WritableStreamDefaultController.prototype.${a} can only be used on a WritableStreamDefaultController`)}function bc(a){return TypeError(`WritableStreamDefaultWriter.prototype.${a} can only be used on a WritableStreamDefaultWriter`)}function bd(a){return TypeError("Cannot "+a+" a stream using a released writer")}function be(a){a._closedPromise=l((b,c)=>{a._closedPromise_resolve=b,a._closedPromise_reject=c,a._closedPromiseState="pending"})}function bf(a,b){void 0!==a._closedPromise_reject&&(o(a._closedPromise),a._closedPromise_reject(b),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0,a._closedPromiseState="rejected")}function bg(a){void 0!==a._closedPromise_resolve&&(a._closedPromise_resolve(void 0),a._closedPromise_resolve=void 0,a._closedPromise_reject=void 0,a._closedPromiseState="resolved")}function bh(a){a._readyPromise=l((b,c)=>{a._readyPromise_resolve=b,a._readyPromise_reject=c}),a._readyPromiseState="pending"}function bi(a,b){bh(a),bj(a,b)}function bj(a,b){void 0!==a._readyPromise_reject&&(o(a._readyPromise),a._readyPromise_reject(b),a._readyPromise_resolve=void 0,a._readyPromise_reject=void 0,a._readyPromiseState="rejected")}function bk(a){void 0!==a._readyPromise_resolve&&(a._readyPromise_resolve(void 0),a._readyPromise_resolve=void 0,a._readyPromise_reject=void 0,a._readyPromiseState="fulfilled")}Object.defineProperties(a3.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),"symbol"==typeof d.toStringTag&&Object.defineProperty(a3.prototype,d.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});let bl="undefined"!=typeof DOMException?DOMException:void 0,bm=!function(a){if("function"!=typeof a&&"object"!=typeof a)return!1;try{return new a,!0}catch(a){return!1}}(bl)?function(){let a=function(a,b){this.message=a||"",this.name=b||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return a.prototype=Object.create(Error.prototype),Object.defineProperty(a.prototype,"constructor",{value:a,writable:!0,configurable:!0}),a}():bl;function bn(a,b,c,d,e,f){let g=a.getReader(),h=b.getWriter();by(a)&&(a._disturbed=!0);let i,q,r,s=!1,t=!1,u="readable",v="writable",w=!1,x=!1,y=l(a=>{r=a}),z=Promise.resolve(void 0);return l((A,B)=>{let C;function D(){if(s)return;let a=l((a,b)=>{!function c(d){d?a():m(s?j(!0):m(h.ready,()=>m(g.read(),a=>!!a.done||(o(z=h.write(a.value)),!1))),c,b)}(!1)});o(a)}function E(){return u="closed",c?I():H(()=>(aR(b)&&(w=aY(b),v=b._state),w||"closed"===v?j(void 0):"erroring"===v||"errored"===v?k(q):(w=!0,h.close())),!1,void 0),null}function F(a){return s||(u="errored",i=a,d?I(!0,a):H(()=>h.abort(a),!0,a)),null}function G(a){return t||(v="errored",q=a,e?I(!0,a):H(()=>g.cancel(a),!0,a)),null}if(void 0!==f&&(C=()=>{let a=void 0!==f.reason?f.reason:new bm("Aborted","AbortError"),b=[];d||b.push(()=>"writable"===v?h.abort(a):j(void 0)),e||b.push(()=>"readable"===u?g.cancel(a):j(void 0)),H(()=>Promise.all(b.map(a=>a())),!0,a)},f.aborted?C():f.addEventListener("abort",C)),by(a)&&(u=a._state,i=a._storedError),aR(b)&&(v=b._state,q=b._storedError,w=aY(b)),by(a)&&aR(b)&&(x=!0,r()),"errored"===u)F(i);else if("erroring"===v||"errored"===v)G(q);else if("closed"===u)E();else if(w||"closed"===v){let a=TypeError("the destination writable stream closed before all data could be piped to it");e?I(!0,a):H(()=>g.cancel(a),!0,a)}function H(a,b,c){function d(){let a;return"writable"!==v||w?e():n(j(function b(){if(a!==z)return a=z,m(z,b,b)}()),e),null}function e(){return a?n(a(),()=>J(b,c),a=>J(!0,a)):J(b,c),null}s||(s=!0,x?d():n(y,d))}function I(a,b){H(void 0,a,b)}function J(a,b){return t=!0,h.releaseLock(),g.releaseLock(),void 0!==f&&f.removeEventListener("abort",C),a?B(b):A(void 0),null}s||(n(g.closed,E,F),n(h.closed,function(){return t||(v="closed"),null},G)),x?D():p(()=>{x=!0,r(),D()})})}class bo{constructor(){throw TypeError("Illegal constructor")}get desiredSize(){if(!bp(this))throw bv("desiredSize");return bt(this)}close(){if(!bp(this))throw bv("close");if(!bu(this))throw TypeError("The stream is not in a state that permits close");!function(a){if(!bu(a))return;let b=a._controlledReadableStream;a._closeRequested=!0,0===a._queue.length&&(br(a),bB(b))}(this)}enqueue(a){if(!bp(this))throw bv("enqueue");if(!bu(this))throw TypeError("The stream is not in a state that permits enqueue");if(!bu(this))return;let b=this._controlledReadableStream;if(bz(b)&&T(b)>0)S(b,a,!1);else{let b;try{b=this._strategySizeAlgorithm(a)}catch(a){throw bs(this,a),a}try{af(this,a,b)}catch(a){throw bs(this,a),a}}bq(this)}error(a){if(!bp(this))throw bv("error");bs(this,a)}[v](a){ag(this);let b=this._cancelAlgorithm(a);return br(this),b}[w](a){let b=this._controlledReadableStream;if(this._queue.length>0){let c=ae(this);this._closeRequested&&0===this._queue.length?(br(this),bB(b)):bq(this),a._chunkSteps(c)}else R(b,a),bq(this)}[x](){}}function bp(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_controlledReadableStream")&&a instanceof bo}function bq(a){if(function(a){let b=a._controlledReadableStream;return!!bu(a)&&!!a._started&&!!(bz(b)&&T(b)>0||bt(a)>0)}(a)){if(a._pulling)return void(a._pullAgain=!0);a._pulling=!0,n(a._pullAlgorithm(),()=>(a._pulling=!1,a._pullAgain&&(a._pullAgain=!1,bq(a)),null),b=>(bs(a,b),null))}}function br(a){a._pullAlgorithm=void 0,a._cancelAlgorithm=void 0,a._strategySizeAlgorithm=void 0}function bs(a,b){let c=a._controlledReadableStream;"readable"===c._state&&(ag(a),br(a),bC(c,b))}function bt(a){let b=a._controlledReadableStream._state;return"errored"===b?null:"closed"===b?0:a._strategyHWM-a._queueTotalSize}function bu(a){return!a._closeRequested&&"readable"===a._controlledReadableStream._state}function bv(a){return TypeError(`ReadableStreamDefaultController.prototype.${a} can only be used on a ReadableStreamDefaultController`)}function bw(a,b){H(a,b);let c=null==a?void 0:a.preventAbort,d=null==a?void 0:a.preventCancel,e=null==a?void 0:a.preventClose,f=null==a?void 0:a.signal;return void 0!==f&&function(a,b){if(!function(a){if("object"!=typeof a||null===a)return!1;try{return"boolean"==typeof a.aborted}catch(a){return!1}}(a))throw TypeError(`${b} is not an AbortSignal.`)}(f,`${b} has member 'signal' that`),{preventAbort:!!c,preventCancel:!!d,preventClose:!!e,signal:f}}Object.defineProperties(bo.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),g(bo.prototype.close,"close"),g(bo.prototype.enqueue,"enqueue"),g(bo.prototype.error,"error"),"symbol"==typeof d.toStringTag&&Object.defineProperty(bo.prototype,d.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});class bx{constructor(a={},b={}){void 0===a?a=null:J(a,"First parameter");let c=aO(b,"Second parameter"),d=function(a,b){H(a,b);let c=null==a?void 0:a.autoAllocateChunkSize,d=null==a?void 0:a.cancel,e=null==a?void 0:a.pull,f=null==a?void 0:a.start,g=null==a?void 0:a.type;return{autoAllocateChunkSize:void 0===c?void 0:N(c,`${b} has member 'autoAllocateChunkSize' that`),cancel:void 0===d?void 0:(I(d,`${b} has member 'cancel' that`),b=>r(d,a,[b])),pull:void 0===e?void 0:(I(e,`${b} has member 'pull' that`),b=>r(e,a,[b])),start:void 0===f?void 0:(I(f,`${b} has member 'start' that`),b=>q(f,a,[b])),type:void 0===g?void 0:function(a,b){if("bytes"!=(a=`${a}`))throw TypeError(`${b} '${a}' is not a valid enumeration value for ReadableStreamType`);return a}(g,`${b} has member 'type' that`)}}(a,"First parameter");if(this._state="readable",this._reader=void 0,this._storedError=void 0,this._disturbed=!1,"bytes"===d.type){if(void 0!==c.size)throw RangeError("The strategy for a byte stream cannot have a size function");!function(a,b,c){let d,e,f,g=Object.create(ai.prototype);d=void 0!==b.start?()=>b.start(g):()=>{},e=void 0!==b.pull?()=>b.pull(g):()=>j(void 0),f=void 0!==b.cancel?a=>b.cancel(a):()=>j(void 0);let h=b.autoAllocateChunkSize;if(0===h)throw TypeError("autoAllocateChunkSize must be greater than 0");g._controlledReadableByteStream=a,g._pullAgain=!1,g._pulling=!1,g._byobRequest=null,g._queue=g._queueTotalSize=void 0,ag(g),g._closeRequested=!1,g._started=!1,g._strategyHWM=c,g._pullAlgorithm=e,g._cancelAlgorithm=f,g._autoAllocateChunkSize=h,g._pendingPullIntos=new s,a._readableStreamController=g,n(j(d()),()=>(g._started=!0,al(g),null),a=>(aA(g,a),null))}(this,d,aM(c,0))}else{let a=aN(c);!function(a,b,c,d){let e,f,g,h=Object.create(bo.prototype);e=void 0!==b.start?()=>b.start(h):()=>{},f=void 0!==b.pull?()=>b.pull(h):()=>j(void 0),g=void 0!==b.cancel?a=>b.cancel(a):()=>j(void 0),h._controlledReadableStream=a,h._queue=void 0,h._queueTotalSize=void 0,ag(h),h._started=!1,h._closeRequested=!1,h._pullAgain=!1,h._pulling=!1,h._strategySizeAlgorithm=d,h._strategyHWM=c,h._pullAlgorithm=f,h._cancelAlgorithm=g,a._readableStreamController=h,n(j(e()),()=>(h._started=!0,bq(h),null),a=>(bs(h,a),null))}(this,d,aM(c,1),a)}}get locked(){if(!by(this))throw bD("locked");return bz(this)}cancel(a){return by(this)?bz(this)?k(TypeError("Cannot cancel a stream that already has a reader")):bA(this,a):k(bD("cancel"))}getReader(a){if(!by(this))throw bD("getReader");return void 0===function(a,b){H(a,b);let c=null==a?void 0:a.mode;return{mode:void 0===c?void 0:function(a,b){if("byob"!=(a=`${a}`))throw TypeError(`${b} '${a}' is not a valid enumeration value for ReadableStreamReaderMode`);return a}(c,`${b} has member 'mode' that`)}}(a,"First parameter").mode?new V(this):new aI(this)}pipeThrough(a,b={}){if(!O(this))throw bD("pipeThrough");K(a,1,"pipeThrough");let c=function(a,b){H(a,b);let c=null==a?void 0:a.readable;L(c,"readable","ReadableWritablePair"),function(a,b){if(!O(a))throw TypeError(`${b} is not a ReadableStream.`)}(c,`${b} has member 'readable' that`);let d=null==a?void 0:a.writable;return L(d,"writable","ReadableWritablePair"),function(a,b){if(!P(a))throw TypeError(`${b} is not a WritableStream.`)}(d,`${b} has member 'writable' that`),{readable:c,writable:d}}(a,"First parameter"),d=bw(b,"Second parameter");if(this.locked)throw TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(c.writable.locked)throw TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return o(bn(this,c.writable,d.preventClose,d.preventAbort,d.preventCancel,d.signal)),c.readable}pipeTo(a,b={}){let c;if(!O(this))return k(bD("pipeTo"));if(void 0===a)return k("Parameter 1 is required in 'pipeTo'.");if(!P(a))return k(TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));try{c=bw(b,"Second parameter")}catch(a){return k(a)}return this.locked?k(TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):a.locked?k(TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):bn(this,a,c.preventClose,c.preventAbort,c.preventCancel,c.signal)}tee(){if(!O(this))throw bD("tee");if(this.locked)throw TypeError("Cannot tee a stream that already has a reader");return!function(a){try{return a.getReader({mode:"byob"}).releaseLock(),!0}catch(a){return!1}}(this)?function(a,b){let c=a.getReader(),d,e,f,g,h,i=!1,k=!1,m=!1,o=!1,p=l(a=>{h=a});function q(){return i?k=!0:(i=!0,n(c.read(),a=>{if(k=!1,a.done)return m||f.close(),o||g.close(),m&&o||h(void 0),null;let b=a.value;return m||f.enqueue(b),o||g.enqueue(b),i=!1,k&&q(),null},()=>(i=!1,null))),j(void 0)}let r=new bx({start(a){f=a},pull:q,cancel:function(a){if(m=!0,d=a,o){let a=[d,e],b=c.cancel(a);h(b)}return p}}),s=new bx({start(a){g=a},pull:q,cancel:function(a){if(o=!0,e=a,m){let a=[d,e],b=c.cancel(a);h(b)}return p}});return n(c.closed,void 0,a=>(f.error(a),g.error(a),m&&o||h(void 0),null)),[r,s]}(this):function(a){let b,c,d,e,f,g=a.getReader(),h=!1,i=!1,k=!1,m=!1,o=!1,p=!1,q=l(a=>{f=a});function r(a){n(a.closed,void 0,b=>(a!==g||(d.error(b),e.error(b),o&&p||f(void 0)),null))}function s(){h&&(g.releaseLock(),r(g=a.getReader()),h=!1),n(g.read(),a=>{var b,c;if(k=!1,m=!1,a.done)return o||d.close(),p||e.close(),null==(b=d.byobRequest)||b.respond(0),null==(c=e.byobRequest)||c.respond(0),o&&p||f(void 0),null;let h=a.value,j=h;if(!o&&!p)try{j=ad(h)}catch(a){return d.error(a),e.error(a),f(g.cancel(a)),null}return o||d.enqueue(h),p||e.enqueue(j),i=!1,k?u():m&&v(),null},()=>(i=!1,null))}function t(b,c){h||(g.releaseLock(),r(g=a.getReader({mode:"byob"})),h=!0);let j=c?e:d,l=c?d:e;n(g.read(b),a=>{var b;k=!1,m=!1;let d=c?p:o,e=c?o:p;if(a.done){d||j.close(),e||l.close();let c=a.value;return void 0!==c&&(d||j.byobRequest.respondWithNewView(c),e||null==(b=l.byobRequest)||b.respond(0)),d&&e||f(void 0),null}let h=a.value;if(e)d||j.byobRequest.respondWithNewView(h);else{let a;try{a=ad(h)}catch(a){return j.error(a),l.error(a),f(g.cancel(a)),null}d||j.byobRequest.respondWithNewView(h),l.enqueue(a)}return i=!1,k?u():m&&v(),null},()=>(i=!1,null))}function u(){if(i)return k=!0,j(void 0);i=!0;let a=d.byobRequest;return null===a?s():t(a.view,!1),j(void 0)}function v(){if(i)return m=!0,j(void 0);i=!0;let a=e.byobRequest;return null===a?s():t(a.view,!0),j(void 0)}let w=new bx({type:"bytes",start(a){d=a},pull:u,cancel:function(a){if(o=!0,b=a,p){let a=[b,c],d=g.cancel(a);f(d)}return q}}),x=new bx({type:"bytes",start(a){e=a},pull:v,cancel:function(a){if(p=!0,c=a,o){let a=[b,c],d=g.cancel(a);f(d)}return q}});return r(g),[w,x]}(this)}values(a){if(!O(this))throw bD("values");return function(a,b){let c=new Z(a.getReader(),b),d=Object.create($);return d._asyncIteratorImpl=c,d}(this,(H(a,"First parameter"),{preventCancel:!!(null==a?void 0:a.preventCancel)}).preventCancel)}}function by(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_readableStreamController")&&a instanceof bx}function bz(a){return void 0!==a._reader}function bA(a,b){if(a._disturbed=!0,"closed"===a._state)return j(void 0);if("errored"===a._state)return k(a._storedError);bB(a);let c=a._reader;if(void 0!==c&&aJ(c)){let a=c._readIntoRequests;c._readIntoRequests=new s,a.forEach(a=>{a._closeSteps(void 0)})}return m(a._readableStreamController[v](b),e,void 0)}function bB(a){a._state="closed";let b=a._reader;if(void 0!==b&&(E(b),W(b))){let a=b._readRequests;b._readRequests=new s,a.forEach(a=>{a._closeSteps()})}}function bC(a,b){a._state="errored",a._storedError=b;let c=a._reader;void 0!==c&&(D(c,b),W(c)?X(c,b):aK(c,b))}function bD(a){return TypeError(`ReadableStream.prototype.${a} can only be used on a ReadableStream`)}function bE(a,b){H(a,b);let c=null==a?void 0:a.highWaterMark;return L(c,"highWaterMark","QueuingStrategyInit"),{highWaterMark:M(c)}}Object.defineProperties(bx.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),g(bx.prototype.cancel,"cancel"),g(bx.prototype.getReader,"getReader"),g(bx.prototype.pipeThrough,"pipeThrough"),g(bx.prototype.pipeTo,"pipeTo"),g(bx.prototype.tee,"tee"),g(bx.prototype.values,"values"),"symbol"==typeof d.toStringTag&&Object.defineProperty(bx.prototype,d.toStringTag,{value:"ReadableStream",configurable:!0}),"symbol"==typeof d.asyncIterator&&Object.defineProperty(bx.prototype,d.asyncIterator,{value:bx.prototype.values,writable:!0,configurable:!0});let bF=a=>a.byteLength;g(bF,"size");class bG{constructor(a){K(a,1,"ByteLengthQueuingStrategy"),a=bE(a,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=a.highWaterMark}get highWaterMark(){if(!bI(this))throw bH("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!bI(this))throw bH("size");return bF}}function bH(a){return TypeError(`ByteLengthQueuingStrategy.prototype.${a} can only be used on a ByteLengthQueuingStrategy`)}function bI(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_byteLengthQueuingStrategyHighWaterMark")&&a instanceof bG}Object.defineProperties(bG.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof d.toStringTag&&Object.defineProperty(bG.prototype,d.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});let bJ=()=>1;g(bJ,"size");class bK{constructor(a){K(a,1,"CountQueuingStrategy"),a=bE(a,"First parameter"),this._countQueuingStrategyHighWaterMark=a.highWaterMark}get highWaterMark(){if(!bM(this))throw bL("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!bM(this))throw bL("size");return bJ}}function bL(a){return TypeError(`CountQueuingStrategy.prototype.${a} can only be used on a CountQueuingStrategy`)}function bM(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_countQueuingStrategyHighWaterMark")&&a instanceof bK}Object.defineProperties(bK.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof d.toStringTag&&Object.defineProperty(bK.prototype,d.toStringTag,{value:"CountQueuingStrategy",configurable:!0});class bN{constructor(a={},b={},c={}){let d;void 0===a&&(a=null);let e=aO(b,"Second parameter"),f=aO(c,"Third parameter"),g=function(a,b){H(a,b);let c=null==a?void 0:a.flush,d=null==a?void 0:a.readableType,e=null==a?void 0:a.start,f=null==a?void 0:a.transform,g=null==a?void 0:a.writableType;return{flush:void 0===c?void 0:(I(c,`${b} has member 'flush' that`),b=>r(c,a,[b])),readableType:d,start:void 0===e?void 0:(I(e,`${b} has member 'start' that`),b=>q(e,a,[b])),transform:void 0===f?void 0:(I(f,`${b} has member 'transform' that`),(b,c)=>r(f,a,[b,c])),writableType:g}}(a,"First parameter");if(void 0!==g.readableType)throw RangeError("Invalid readableType specified");if(void 0!==g.writableType)throw RangeError("Invalid writableType specified");let h=aM(f,0),i=aN(f),n=aM(e,1),o=aN(e);!function(a,b,c,d,e,f){var g,h,i;function k(){return b}a._writableState="writable",a._writableStoredError=void 0,a._writableHasInFlightOperation=!1,a._writableStarted=!1,g=function(b){let c=a._transformStreamController;return a._backpressure?m(a._backpressureChangePromise,()=>{if("erroring"===(aR(a._writable)?a._writable._state:a._writableState))throw aR(a._writable)?a._writable._storedError:a._writableStoredError;return bW(c,b)},void 0):bW(c,b)},h=function(){var b=a;let c=b._transformStreamController,d=c._flushAlgorithm();return bU(c),m(d,()=>{if("errored"===b._readableState)throw b._readableStoredError;bZ(b)&&b$(b)},a=>{throw bP(b,a),b._readableStoredError})},a._writable=new aQ({start(b){a._writableController=b;try{let c=b.signal;void 0!==c&&c.addEventListener("abort",()=>{"writable"===a._writableState&&(a._writableState="erroring",c.reason&&(a._writableStoredError=c.reason))})}catch(a){}return m(k(),()=>(a._writableStarted=!0,b4(a),null),b=>{throw a._writableStarted=!0,b1(a,b),b})},write:b=>(a._writableHasInFlightOperation=!0,m(g(b),()=>(a._writableHasInFlightOperation=!1,b4(a),null),b=>{throw a._writableHasInFlightOperation=!1,b1(a,b),b})),close:()=>(a._writableHasInFlightOperation=!0,m(h(),()=>(a._writableHasInFlightOperation=!1,"erroring"===a._writableState&&(a._writableStoredError=void 0),a._writableState="closed",null),b=>{throw a._writableHasInFlightOperation=!1,a._writableState,b1(a,b),b})),abort:b=>(a._writableState="errored",a._writableStoredError=b,function(b){return bP(a,b),j(void 0)}(b))},{highWaterMark:c,size:d}),a._readableState="readable",a._readableStoredError=void 0,a._readableCloseRequested=!1,a._readablePulling=!1,i=function(){return bR(a,!1),a._backpressureChangePromise},a._readable=new bx({start:b=>(a._readableController=b,k().catch(b=>{b_(a,b)})),pull:()=>(a._readablePulling=!0,i().catch(b=>{b_(a,b)})),cancel:b=>(a._readableState="closed",function(b){return bQ(a,b),j(void 0)}(b))},{highWaterMark:e,size:f}),a._backpressure=void 0,a._backpressureChangePromise=void 0,a._backpressureChangePromise_resolve=void 0,bR(a,!0),a._transformStreamController=void 0}(this,l(a=>{d=a}),n,o,h,i),function(a,b){let c,d,e=Object.create(bS.prototype);c=void 0!==b.transform?a=>b.transform(a,e):a=>{try{var b;return bV(e,a),b=void 0,j(b)}catch(a){return k(a)}},d=void 0!==b.flush?()=>b.flush(e):()=>j(void 0),e._controlledTransformStream=a,a._transformStreamController=e,e._transformAlgorithm=c,e._flushAlgorithm=d}(this,g),void 0!==g.start?d(g.start(this._transformStreamController)):d(void 0)}get readable(){if(!bO(this))throw bY("readable");return this._readable}get writable(){if(!bO(this))throw bY("writable");return this._writable}}function bO(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_transformStreamController")&&a instanceof bN}function bP(a,b){b_(a,b),bQ(a,b)}function bQ(a,b){bU(a._transformStreamController),a._writableController.error(b),"writable"===a._writableState&&b2(a,b),a._backpressure&&bR(a,!1)}function bR(a,b){void 0!==a._backpressureChangePromise&&a._backpressureChangePromise_resolve(),a._backpressureChangePromise=l(b=>{a._backpressureChangePromise_resolve=b}),a._backpressure=b}Object.defineProperties(bN.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),"symbol"==typeof d.toStringTag&&Object.defineProperty(bN.prototype,d.toStringTag,{value:"TransformStream",configurable:!0});class bS{constructor(){throw TypeError("Illegal constructor")}get desiredSize(){if(!bT(this))throw bX("desiredSize");return b0(this._controlledTransformStream)}enqueue(a){if(!bT(this))throw bX("enqueue");bV(this,a)}error(a){if(!bT(this))throw bX("error");bP(this._controlledTransformStream,a)}terminate(){if(!bT(this))throw bX("terminate");let a=this._controlledTransformStream;bZ(a)&&b$(a),bQ(a,TypeError("TransformStream terminated"))}}function bT(a){return!!f(a)&&!!Object.prototype.hasOwnProperty.call(a,"_controlledTransformStream")&&a instanceof bS}function bU(a){a._transformAlgorithm=void 0,a._flushAlgorithm=void 0}function bV(a,b){let c=a._controlledTransformStream;if(!bZ(c))throw TypeError("Readable side is not in a state that permits enqueue");try{c._readablePulling=!1;try{c._readableController.enqueue(b)}catch(a){throw b_(c,a),a}}catch(a){throw bQ(c,a),c._readableStoredError}!(bZ(c)&&(c._readablePulling||b0(c)>0))!==c._backpressure&&bR(c,!0)}function bW(a,b){return m(a._transformAlgorithm(b),void 0,b=>{throw bP(a._controlledTransformStream,b),b})}function bX(a){return TypeError(`TransformStreamDefaultController.prototype.${a} can only be used on a TransformStreamDefaultController`)}function bY(a){return TypeError(`TransformStream.prototype.${a} can only be used on a TransformStream`)}function bZ(a){return!a._readableCloseRequested&&"readable"===a._readableState}function b$(a){a._readableState="closed",a._readableCloseRequested=!0,a._readableController.close()}function b_(a,b){"readable"===a._readableState&&(a._readableState="errored",a._readableStoredError=b),a._readableController.error(b)}function b0(a){return a._readableController.desiredSize}function b1(a,b){"writable"!==a._writableState?b3(a):b2(a,b)}function b2(a,b){a._writableState="erroring",a._writableStoredError=b,!a._writableHasInFlightOperation&&a._writableStarted&&b3(a)}function b3(a){a._writableState="errored"}function b4(a){"erroring"===a._writableState&&b3(a)}Object.defineProperties(bS.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),g(bS.prototype.enqueue,"enqueue"),g(bS.prototype.error,"error"),g(bS.prototype.terminate,"terminate"),"symbol"==typeof d.toStringTag&&Object.defineProperty(bS.prototype,d.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});var b5,b6,b7,b8=c(71636);async function*b9(a){let b=a.byteOffset+a.byteLength,c=a.byteOffset;for(;c!==b;){let d=Math.min(b-c,65536),e=a.buffer.slice(c,c+d);c+=e.byteLength,yield new Uint8Array(e)}}async function*ca(a){let b=0;for(;b!==a.size;){let c=a.slice(b,Math.min(a.size,b+65536)),d=await c.arrayBuffer();b+=d.byteLength,yield new Uint8Array(d)}}async function*cb(a,b=!1){for(let c of a)ArrayBuffer.isView(c)?b?yield*b9(c):yield c:(0,b8.T)(c.stream)?yield*c.stream():yield*ca(c)}var cc=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)},cd=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c};class ce{constructor(a=[],b={}){if(b5.set(this,[]),b6.set(this,""),b7.set(this,0),null!=b||(b={}),"object"!=typeof a||null===a)throw TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(!(0,b8.T)(a[Symbol.iterator]))throw TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if("object"!=typeof b&&!(0,b8.T)(b))throw TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");let c=new TextEncoder;for(let b of a){let a;a=ArrayBuffer.isView(b)?new Uint8Array(b.buffer.slice(b.byteOffset,b.byteOffset+b.byteLength)):b instanceof ArrayBuffer?new Uint8Array(b.slice(0)):b instanceof ce?b:c.encode(String(b)),cd(this,b7,cc(this,b7,"f")+(ArrayBuffer.isView(a)?a.byteLength:a.size),"f"),cc(this,b5,"f").push(a)}let d=void 0===b.type?"":String(b.type);cd(this,b6,/^[\x20-\x7E]*$/.test(d)?d:"","f")}static[(b5=new WeakMap,b6=new WeakMap,b7=new WeakMap,Symbol.hasInstance)](a){return!!(a&&"object"==typeof a&&(0,b8.T)(a.constructor)&&((0,b8.T)(a.stream)||(0,b8.T)(a.arrayBuffer))&&/^(Blob|File)$/.test(a[Symbol.toStringTag]))}get type(){return cc(this,b6,"f")}get size(){return cc(this,b7,"f")}slice(a,b,c){return new ce(function*(a,b,c=0,d){null!=d||(d=b);let e=c<0?Math.max(b+c,0):Math.min(c,b),f=d<0?Math.max(b+d,0):Math.min(d,b),g=Math.max(f-e,0),h=0;for(let b of a){if(h>=g)break;let a=ArrayBuffer.isView(b)?b.byteLength:b.size;if(e&&a<=e)e-=a,f-=a;else{let c;ArrayBuffer.isView(b)?h+=(c=b.subarray(e,Math.min(a,f))).byteLength:h+=(c=b.slice(e,Math.min(a,f))).size,f-=a,e=0,yield c}}}(cc(this,b5,"f"),this.size,a,b),{type:c})}async text(){let a=new TextDecoder,b="";for await(let c of cb(cc(this,b5,"f")))b+=a.decode(c,{stream:!0});return b+a.decode()}async arrayBuffer(){let a=new Uint8Array(this.size),b=0;for await(let c of cb(cc(this,b5,"f")))a.set(c,b),b+=c.length;return a.buffer}stream(){let a=cb(cc(this,b5,"f"),!0);return new bx({async pull(b){let{value:c,done:d}=await a.next();if(d)return queueMicrotask(()=>b.close());b.enqueue(c)},async cancel(){await a.return()}})}get[Symbol.toStringTag](){return"Blob"}}Object.defineProperties(ce.prototype,{type:{enumerable:!0},size:{enumerable:!0},slice:{enumerable:!0},stream:{enumerable:!0},text:{enumerable:!0},arrayBuffer:{enumerable:!0}})},5231:(a,b,c)=>{"use strict";let d,e,f,g,h,i,j,k,l,m;c.r(b),c.d(b,{handler:()=>eF,patchFetch:()=>eE,routeModule:()=>eA,serverHooks:()=>eD,workAsyncStorage:()=>eB,workUnitAsyncStorage:()=>eC});var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL={};c.r(aL),c.d(aL,{POST:()=>ew});var aM=c(12861),aN=c(3658),aO=c(18921),aP=c(33321),aQ=c(22587),aR=c(261),aS=c(10945),aT=c(97519),aU=c(54217),aV=c(89786),aW=c(39228),aX=c(89510),aY=c(54028),aZ=c(82317),a$=c(86439),a_=c(72179),a0=c(99852);let a1="RFC3986",a2={RFC1738:a=>String(a).replace(/%20/g,"+"),RFC3986:a=>String(a)};Object.prototype.hasOwnProperty;let a3=Array.isArray,a4=(()=>{let a=[];for(let b=0;b<256;++b)a.push("%"+((b<16?"0":"")+b.toString(16)).toUpperCase());return a})();function a5(a,b){if(a3(a)){let c=[];for(let d=0;d<a.length;d+=1)c.push(b(a[d]));return c}return b(a)}let a6=Object.prototype.hasOwnProperty,a7={brackets:a=>String(a)+"[]",comma:"comma",indices:(a,b)=>String(a)+"["+b+"]",repeat:a=>String(a)},a8=Array.isArray,a9=Array.prototype.push,ba=function(a,b){a9.apply(a,a8(b)?b:[b])},bb=Date.prototype.toISOString,bc={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(a,b,c,d,e)=>{if(0===a.length)return a;let f=a;if("symbol"==typeof a?f=Symbol.prototype.toString.call(a):"string"!=typeof a&&(f=String(a)),"iso-8859-1"===c)return escape(f).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let g="";for(let a=0;a<f.length;a+=1024){let b=f.length>=1024?f.slice(a,a+1024):f,c=[];for(let a=0;a<b.length;++a){let d=b.charCodeAt(a);if(45===d||46===d||95===d||126===d||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||"RFC1738"===e&&(40===d||41===d)){c[c.length]=b.charAt(a);continue}if(d<128){c[c.length]=a4[d];continue}if(d<2048){c[c.length]=a4[192|d>>6]+a4[128|63&d];continue}if(d<55296||d>=57344){c[c.length]=a4[224|d>>12]+a4[128|d>>6&63]+a4[128|63&d];continue}a+=1,d=65536+((1023&d)<<10|1023&b.charCodeAt(a)),c[c.length]=a4[240|d>>18]+a4[128|d>>12&63]+a4[128|d>>6&63]+a4[128|63&d]}g+=c.join("")}return g},encodeValuesOnly:!1,format:a1,formatter:a2[a1],indices:!1,serializeDate:a=>bb.call(a),skipNulls:!1,strictNullHandling:!1},bd={},be="4.104.0",bf=!1;var bg=c(20317),bh=c(28354),bi=c(32714),bj=c(39078),bk=c(4537),bl=c(71636);let bm=(0,bh.deprecate)(()=>{},'Constructor "entries" argument is not spec-compliant and will be removed in next major release.');var bn=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class bo{constructor(a){n.add(this),o.set(this,new Map),a&&(bm(),a.forEach(({name:a,value:b,fileName:c})=>this.append(a,b,c)))}static[(o=new WeakMap,n=new WeakSet,Symbol.hasInstance)](a){return!!(a&&(0,bl.T)(a.constructor)&&"FormData"===a[Symbol.toStringTag]&&(0,bl.T)(a.append)&&(0,bl.T)(a.set)&&(0,bl.T)(a.get)&&(0,bl.T)(a.getAll)&&(0,bl.T)(a.has)&&(0,bl.T)(a.delete)&&(0,bl.T)(a.entries)&&(0,bl.T)(a.values)&&(0,bl.T)(a.keys)&&(0,bl.T)(a[Symbol.iterator])&&(0,bl.T)(a.forEach))}append(a,b,c){bn(this,n,"m",p).call(this,{name:a,fileName:c,append:!0,rawValue:b,argsLength:arguments.length})}set(a,b,c){bn(this,n,"m",p).call(this,{name:a,fileName:c,append:!1,rawValue:b,argsLength:arguments.length})}get(a){let b=bn(this,o,"f").get(String(a));return b?b[0]:null}getAll(a){let b=bn(this,o,"f").get(String(a));return b?b.slice():[]}has(a){return bn(this,o,"f").has(String(a))}delete(a){bn(this,o,"f").delete(String(a))}*keys(){for(let a of bn(this,o,"f").keys())yield a}*entries(){for(let a of this.keys())for(let b of this.getAll(a))yield[a,b]}*values(){for(let[,a]of this)yield a}[(p=function({name:a,rawValue:b,append:c,fileName:d,argsLength:e}){let f,g=c?"append":"set";if(e<2)throw TypeError(`Failed to execute '${g}' on 'FormData': 2 arguments required, but only ${e} present.`);if(a=String(a),(0,bj.f)(b))f=void 0===d?b:new bi.Z([b],d,{type:b.type,lastModified:b.lastModified});else if(b instanceof bk.Y)f=new bi.Z([b],void 0===d?"blob":d,{type:b.type});else if(d)throw TypeError(`Failed to execute '${g}' on 'FormData': parameter 2 is not of type 'Blob'.`);else f=String(b);let h=bn(this,o,"f").get(a);if(!h||!c)return void bn(this,o,"f").set(a,[f]);h.push(f)},Symbol.iterator)](){return this.entries()}forEach(a,b){for(let[c,d]of this)a.call(b,d,c,this)}get[Symbol.toStringTag](){return"FormData"}[bh.inspect.custom](){return this[Symbol.toStringTag]}}var bp=c(85725),bq=c(95046);let br=require("node:fs"),bs="abcdefghijklmnopqrstuvwxyz0123456789",bt=function(){let a=16,b="";for(;a--;)b+=bs[Math.random()*bs.length|0];return b},bu=function(a){if("object"!==Object.prototype.toString.call(a).slice(8,-1).toLowerCase())return!1;let b=Object.getPrototypeOf(a);return null==b||(b.constructor&&b.constructor.toString())===Object.toString()},bv=a=>String(a).replace(/\r|\n/g,(a,b,c)=>"\r"===a&&"\n"!==c[b+1]||"\n"===a&&"\r"!==c[b-1]?"\r\n":a),bw=a=>String(a).replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/"/g,"%22"),bx=a=>!!(a&&"object"==typeof a&&"function"==typeof a.constructor&&"File"===a[Symbol.toStringTag]&&"function"==typeof a.stream&&null!=a.name&&null!=a.size&&null!=a.lastModified);var by=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},bz=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};let bA={enableAdditionalHeaders:!1};class bB{constructor(a,b,c){let d;if(q.add(this),r.set(this,"\r\n"),s.set(this,void 0),t.set(this,void 0),u.set(this,"-".repeat(2)),v.set(this,new TextEncoder),w.set(this,void 0),x.set(this,void 0),y.set(this,void 0),!(a=>!!(a&&"function"==typeof a.constructor&&"FormData"===a[Symbol.toStringTag]&&"function"==typeof a.append&&"function"==typeof a.getAll&&"function"==typeof a.entries&&"function"==typeof a[Symbol.iterator]))(a))throw TypeError("Expected first argument to be a FormData instance.");if(bu(b)?c=b:d=b,d||(d=bt()),"string"!=typeof d)throw TypeError("Expected boundary argument to be a string.");if(c&&!bu(c))throw TypeError("Expected options argument to be an object.");by(this,x,a,"f"),by(this,y,{...bA,...c},"f"),by(this,s,bz(this,v,"f").encode(bz(this,r,"f")),"f"),by(this,t,bz(this,s,"f").byteLength,"f"),this.boundary=`form-data-boundary-${d}`,this.contentType=`multipart/form-data; boundary=${this.boundary}`,by(this,w,bz(this,v,"f").encode(`${bz(this,u,"f")}${this.boundary}${bz(this,u,"f")}${bz(this,r,"f").repeat(2)}`),"f"),this.contentLength=String(this.getContentLength()),this.headers=Object.freeze({"Content-Type":this.contentType,"Content-Length":this.contentLength}),Object.defineProperties(this,{boundary:{writable:!1,configurable:!1},contentType:{writable:!1,configurable:!1},contentLength:{writable:!1,configurable:!1},headers:{writable:!1,configurable:!1}})}getContentLength(){let a=0;for(let[b,c]of bz(this,x,"f")){let d=bx(c)?c:bz(this,v,"f").encode(bv(c));a+=bz(this,q,"m",z).call(this,b,d).byteLength,a+=bx(d)?d.size:d.byteLength,a+=bz(this,t,"f")}return a+bz(this,w,"f").byteLength}*values(){for(let[a,b]of bz(this,x,"f").entries()){let c=bx(b)?b:bz(this,v,"f").encode(bv(b));yield bz(this,q,"m",z).call(this,a,c),yield c,yield bz(this,s,"f")}yield bz(this,w,"f")}async *encode(){for(let a of this.values())bx(a)?yield*a.stream():yield a}[(r=new WeakMap,s=new WeakMap,t=new WeakMap,u=new WeakMap,v=new WeakMap,w=new WeakMap,x=new WeakMap,y=new WeakMap,q=new WeakSet,z=function(a,b){let c="";return c+=`${bz(this,u,"f")}${this.boundary}${bz(this,r,"f")}Content-Disposition: form-data; name="${bw(a)}"`,bx(b)&&(c+=`; filename="${bw(b.name)}"${bz(this,r,"f")}Content-Type: ${b.type||"application/octet-stream"}`),!0===bz(this,y,"f").enableAdditionalHeaders&&(c+=`${bz(this,r,"f")}Content-Length: ${bx(b)?b.size:b.byteLength}`),bz(this,v,"f").encode(`${c}${bz(this,r,"f").repeat(2)}`)},Symbol.iterator)](){return this.values()}[Symbol.asyncIterator](){return this.encode()}}let bC=require("node:stream");class bD{constructor(a){this.body=a}get[Symbol.toStringTag](){return"MultipartBody"}}let bE=require("node:stream/web"),bF=!1;async function bG(a,...b){let{fileFromPath:d}=await c.e(165).then(c.bind(c,4165));return bF||(console.warn(`fileFromPath is deprecated; use fs.createReadStream(${JSON.stringify(a)}) instead`),bF=!0),await d(a,...b)}let bH=new bp({keepAlive:!0,timeout:3e5}),bI=new bp.HttpsAgent({keepAlive:!0,timeout:3e5});async function bJ(a,b){let c=new bB(a),d=new bD(bC.Readable.from(c)),e={...b.headers,...c.headers,"Content-Length":c.contentLength};return{...b,body:d,headers:e}}let bK=()=>{e||function(a,b={auto:!1}){if(bf)throw Error(`you must \`import 'openai/shims/${a.kind}'\` before importing anything else from openai`);if(e)throw Error(`can't \`import 'openai/shims/${a.kind}'\` after \`import 'openai/shims/${e}'\``);bf=b.auto,e=a.kind,f=a.fetch,a.Request,a.Response,a.Headers,g=a.FormData,a.Blob,h=a.File,i=a.ReadableStream,j=a.getMultipartRequestOptions,k=a.getDefaultAgent,l=a.fileFromPath,m=a.isFsReadStream}(("undefined"==typeof AbortController&&(globalThis.AbortController=bq.AbortController),{kind:"node",fetch:bg.default,Request:bg.Request,Response:bg.Response,Headers:bg.Headers,FormData:bo,Blob:bk.Y,File:bi.Z,ReadableStream:bE.ReadableStream,getMultipartRequestOptions:bJ,getDefaultAgent:a=>a.startsWith("https")?bI:bH,fileFromPath:bG,isFsReadStream:a=>a instanceof br.ReadStream}),{auto:!0})};bK();class bL extends Error{}class bM extends bL{constructor(a,b,c,d){super(`${bM.makeMessage(a,b,c)}`),this.status=a,this.headers=d,this.request_id=d?.["x-request-id"],this.error=b,this.code=b?.code,this.param=b?.param,this.type=b?.type}static makeMessage(a,b,c){let d=b?.message?"string"==typeof b.message?b.message:JSON.stringify(b.message):b?JSON.stringify(b):c;return a&&d?`${a} ${d}`:a?`${a} status code (no body)`:d||"(no status code or body)"}static generate(a,b,c,d){if(!a||!d)return new bO({message:c,cause:cC(b)});let e=b?.error;return 400===a?new bQ(a,e,c,d):401===a?new bR(a,e,c,d):403===a?new bS(a,e,c,d):404===a?new bT(a,e,c,d):409===a?new bU(a,e,c,d):422===a?new bV(a,e,c,d):429===a?new bW(a,e,c,d):a>=500?new bX(a,e,c,d):new bM(a,e,c,d)}}class bN extends bM{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0)}}class bO extends bM{constructor({message:a,cause:b}){super(void 0,void 0,a||"Connection error.",void 0),b&&(this.cause=b)}}class bP extends bO{constructor({message:a}={}){super({message:a??"Request timed out."})}}class bQ extends bM{}class bR extends bM{}class bS extends bM{}class bT extends bM{}class bU extends bM{}class bV extends bM{}class bW extends bM{}class bX extends bM{}class bY extends bL{constructor(){super("Could not parse response content as the length limit was reached")}}class bZ extends bL{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var b$=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},b_=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class b0{constructor(){A.set(this,void 0),this.buffer=new Uint8Array,b$(this,A,null,"f")}decode(a){let b;if(null==a)return[];let c=a instanceof ArrayBuffer?new Uint8Array(a):"string"==typeof a?new TextEncoder().encode(a):a,d=new Uint8Array(this.buffer.length+c.length);d.set(this.buffer),d.set(c,this.buffer.length),this.buffer=d;let e=[];for(;null!=(b=function(a,b){for(let c=b??0;c<a.length;c++){if(10===a[c])return{preceding:c,index:c+1,carriage:!1};if(13===a[c])return{preceding:c,index:c+1,carriage:!0}}return null}(this.buffer,b_(this,A,"f")));){if(b.carriage&&null==b_(this,A,"f")){b$(this,A,b.index,"f");continue}if(null!=b_(this,A,"f")&&(b.index!==b_(this,A,"f")+1||b.carriage)){e.push(this.decodeText(this.buffer.slice(0,b_(this,A,"f")-1))),this.buffer=this.buffer.slice(b_(this,A,"f")),b$(this,A,null,"f");continue}let a=null!==b_(this,A,"f")?b.preceding-1:b.preceding,c=this.decodeText(this.buffer.slice(0,a));e.push(c),this.buffer=this.buffer.slice(b.index),b$(this,A,null,"f")}return e}decodeText(a){if(null==a)return"";if("string"==typeof a)return a;if("undefined"!=typeof Buffer){if(a instanceof Buffer)return a.toString();if(a instanceof Uint8Array)return Buffer.from(a).toString();throw new bL(`Unexpected: received non-Uint8Array (${a.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(a instanceof Uint8Array||a instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(a);throw new bL(`Unexpected: received non-Uint8Array/ArrayBuffer (${a.constructor.name}) in a web platform. Please report this error.`)}throw new bL("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function b1(a){if(a[Symbol.asyncIterator])return a;let b=a.getReader();return{async next(){try{let a=await b.read();return a?.done&&b.releaseLock(),a}catch(a){throw b.releaseLock(),a}},async return(){let a=b.cancel();return b.releaseLock(),await a,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}A=new WeakMap,b0.NEWLINE_CHARS=new Set(["\n","\r"]),b0.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class b2{constructor(a,b){this.iterator=a,this.controller=b}static fromSSEResponse(a,b){let c=!1;async function*d(){if(c)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");c=!0;let d=!1;try{for await(let c of b3(a,b))if(!d){if(c.data.startsWith("[DONE]")){d=!0;continue}if(null===c.event||c.event.startsWith("response.")||c.event.startsWith("transcript.")){let b;try{b=JSON.parse(c.data)}catch(a){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),a}if(b&&b.error)throw new bM(void 0,b.error,void 0,cr(a.headers));yield b}else{let a;try{a=JSON.parse(c.data)}catch(a){throw console.error("Could not parse message into JSON:",c.data),console.error("From chunk:",c.raw),a}if("error"==c.event)throw new bM(void 0,a.error,a.message,void 0);yield{event:c.event,data:a}}}d=!0}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;throw a}finally{d||b.abort()}}return new b2(d,b)}static fromReadableStream(a,b){let c=!1;async function*d(){let b=new b0;for await(let c of b1(a))for(let a of b.decode(c))yield a;for(let a of b.flush())yield a}return new b2(async function*(){if(c)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");c=!0;let a=!1;try{for await(let b of d())!a&&b&&(yield JSON.parse(b));a=!0}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;throw a}finally{a||b.abort()}},b)}[Symbol.asyncIterator](){return this.iterator()}tee(){let a=[],b=[],c=this.iterator(),d=d=>({next:()=>{if(0===d.length){let d=c.next();a.push(d),b.push(d)}return d.shift()}});return[new b2(()=>d(a),this.controller),new b2(()=>d(b),this.controller)]}toReadableStream(){let a,b=this,c=new TextEncoder;return new i({async start(){a=b[Symbol.asyncIterator]()},async pull(b){try{let{value:d,done:e}=await a.next();if(e)return b.close();let f=c.encode(JSON.stringify(d)+"\n");b.enqueue(f)}catch(a){b.error(a)}},async cancel(){await a.return?.()}})}}async function*b3(a,b){if(!a.body)throw b.abort(),new bL("Attempted to iterate over a response with no body");let c=new b5,d=new b0;for await(let b of b4(b1(a.body)))for(let a of d.decode(b)){let b=c.decode(a);b&&(yield b)}for(let a of d.flush()){let b=c.decode(a);b&&(yield b)}}async function*b4(a){let b=new Uint8Array;for await(let c of a){let a;if(null==c)continue;let d=c instanceof ArrayBuffer?new Uint8Array(c):"string"==typeof c?new TextEncoder().encode(c):c,e=new Uint8Array(b.length+d.length);for(e.set(b),e.set(d,b.length),b=e;-1!==(a=function(a){for(let b=0;b<a.length-1;b++){if(10===a[b]&&10===a[b+1]||13===a[b]&&13===a[b+1])return b+2;if(13===a[b]&&10===a[b+1]&&b+3<a.length&&13===a[b+2]&&10===a[b+3])return b+4}return -1}(b));)yield b.slice(0,a),b=b.slice(a)}b.length>0&&(yield b)}class b5{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(a),a.startsWith(":"))return null;let[b,c,d]=function(a,b){let c=a.indexOf(":");return -1!==c?[a.substring(0,c),b,a.substring(c+b.length)]:[a,"",""]}(a,":");return d.startsWith(" ")&&(d=d.substring(1)),"event"===b?this.event=d:"data"===b&&this.data.push(d),null}}let b6=a=>null!=a&&"object"==typeof a&&"string"==typeof a.url&&"function"==typeof a.blob,b7=a=>null!=a&&"object"==typeof a&&"string"==typeof a.name&&"number"==typeof a.lastModified&&b8(a),b8=a=>null!=a&&"object"==typeof a&&"number"==typeof a.size&&"string"==typeof a.type&&"function"==typeof a.text&&"function"==typeof a.slice&&"function"==typeof a.arrayBuffer,b9=a=>b7(a)||b6(a)||m(a);async function ca(a,b,c){var d;if(b7(a=await a))return a;if(b6(a)){let d=await a.blob();b||(b=new URL(a.url).pathname.split(/[\\/]/).pop()??"unknown_file");let e=b8(d)?[await d.arrayBuffer()]:[d];return new h(e,b,c)}let e=await cb(a);if(b||(b=(cc((d=a).name)||cc(d.filename)||cc(d.path)?.split(/[\\/]/).pop())??"unknown_file"),!c?.type){let a=e[0]?.type;"string"==typeof a&&(c={...c,type:a})}return new h(e,b,c)}async function cb(a){let b=[];if("string"==typeof a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer)b.push(a);else if(b8(a))b.push(await a.arrayBuffer());else if(cd(a))for await(let c of a)b.push(c);else throw Error(`Unexpected data type: ${typeof a}; constructor: ${a?.constructor?.name}; props: ${function(a){let b=Object.getOwnPropertyNames(a);return`[${b.map(a=>`"${a}"`).join(", ")}]`}(a)}`);return b}let cc=a=>"string"==typeof a?a:"undefined"!=typeof Buffer&&a instanceof Buffer?String(a):void 0,cd=a=>null!=a&&"object"==typeof a&&"function"==typeof a[Symbol.asyncIterator],ce=a=>a&&"object"==typeof a&&a.body&&"MultipartBody"===a[Symbol.toStringTag],cf=async a=>{let b=await cg(a.body);return j(b,a)},cg=async a=>{let b=new g;return await Promise.all(Object.entries(a||{}).map(([a,c])=>ci(b,a,c))),b},ch=a=>{if(b9(a))return!0;if(Array.isArray(a))return a.some(ch);if(a&&"object"==typeof a){for(let b in a)if(ch(a[b]))return!0}return!1},ci=async(a,b,c)=>{if(void 0!==c){if(null==c)throw TypeError(`Received null for "${b}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof c||"number"==typeof c||"boolean"==typeof c)a.append(b,String(c));else if(b9(c)){let d=await ca(c);a.append(b,d)}else if(Array.isArray(c))await Promise.all(c.map(c=>ci(a,b+"[]",c)));else if("object"==typeof c)await Promise.all(Object.entries(c).map(([c,d])=>ci(a,`${b}[${c}]`,d)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${c} instead`)}};var cj=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},ck=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};async function cl(a){let{response:b}=a;if(a.options.stream)return(cI("response",b.status,b.url,b.headers,b.body),a.options.__streamClass)?a.options.__streamClass.fromSSEResponse(b,a.controller):b2.fromSSEResponse(b,a.controller);if(204===b.status)return null;if(a.options.__binaryResponse)return b;let c=b.headers.get("content-type"),d=c?.split(";")[0]?.trim();if(d?.includes("application/json")||d?.endsWith("+json")){let a=await b.json();return cI("response",b.status,b.url,b.headers,a),cm(a,b)}let e=await b.text();return cI("response",b.status,b.url,b.headers,e),e}function cm(a,b){return!a||"object"!=typeof a||Array.isArray(a)?a:Object.defineProperty(a,"_request_id",{value:b.headers.get("x-request-id"),enumerable:!1})}bK();class cn extends Promise{constructor(a,b=cl){super(a=>{a(null)}),this.responsePromise=a,this.parseResponse=b}_thenUnwrap(a){return new cn(this.responsePromise,async b=>cm(a(await this.parseResponse(b),b),b.response))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){let[a,b]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:b,request_id:b.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(a,b){return this.parse().then(a,b)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}}class co{constructor({baseURL:a,maxRetries:b=2,timeout:c=6e5,httpAgent:d,fetch:e}){this.baseURL=a,this.maxRetries=cB("maxRetries",b),this.timeout=cB("timeout",c),this.httpAgent=d,this.fetch=e??f}authHeaders(a){return{}}defaultHeaders(a){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...cw(),...this.authHeaders(a)}}validateHeaders(a,b){}defaultIdempotencyKey(){return`stainless-node-retry-${cJ()}`}get(a,b){return this.methodRequest("get",a,b)}post(a,b){return this.methodRequest("post",a,b)}patch(a,b){return this.methodRequest("patch",a,b)}put(a,b){return this.methodRequest("put",a,b)}delete(a,b){return this.methodRequest("delete",a,b)}methodRequest(a,b,c){return this.request(Promise.resolve(c).then(async c=>{let d=c&&b8(c?.body)?new DataView(await c.body.arrayBuffer()):c?.body instanceof DataView?c.body:c?.body instanceof ArrayBuffer?new DataView(c.body):c&&ArrayBuffer.isView(c?.body)?new DataView(c.body.buffer):c?.body;return{method:a,path:b,...c,body:d}}))}getAPIList(a,b,c){return this.requestAPIList(b,{method:"get",path:a,...c})}calculateContentLength(a){if("string"==typeof a){if("undefined"!=typeof Buffer)return Buffer.byteLength(a,"utf8").toString();if("undefined"!=typeof TextEncoder)return new TextEncoder().encode(a).length.toString()}else if(ArrayBuffer.isView(a))return a.byteLength.toString();return null}buildRequest(a,{retryCount:b=0}={}){let c={...a},{method:d,path:e,query:f,headers:g={}}=c,h=ArrayBuffer.isView(c.body)||c.__binaryRequest&&"string"==typeof c.body?c.body:ce(c.body)?c.body.body:c.body?JSON.stringify(c.body,null,2):null,i=this.calculateContentLength(h),j=this.buildURL(e,f);"timeout"in c&&cB("timeout",c.timeout),c.timeout=c.timeout??this.timeout;let l=c.httpAgent??this.httpAgent??k(j),m=c.timeout+1e3;"number"==typeof l?.options?.timeout&&m>(l.options.timeout??0)&&(l.options.timeout=m),this.idempotencyHeader&&"get"!==d&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),g[this.idempotencyHeader]=a.idempotencyKey);let n=this.buildHeaders({options:c,headers:g,contentLength:i,retryCount:b});return{req:{method:d,...h&&{body:h},headers:n,...l&&{agent:l},signal:c.signal??null},url:j,timeout:c.timeout}}buildHeaders({options:a,headers:b,contentLength:c,retryCount:d}){let f={};c&&(f["content-length"]=c);let g=this.defaultHeaders(a);return cG(f,g),cG(f,b),ce(a.body)&&"node"!==e&&delete f["content-type"],void 0===cK(g,"x-stainless-retry-count")&&void 0===cK(b,"x-stainless-retry-count")&&(f["x-stainless-retry-count"]=String(d)),void 0===cK(g,"x-stainless-timeout")&&void 0===cK(b,"x-stainless-timeout")&&a.timeout&&(f["x-stainless-timeout"]=String(Math.trunc(a.timeout/1e3))),this.validateHeaders(f,b),f}async prepareOptions(a){}async prepareRequest(a,{url:b,options:c}){}parseHeaders(a){return a?Symbol.iterator in a?Object.fromEntries(Array.from(a).map(a=>[...a])):{...a}:{}}makeStatusError(a,b,c,d){return bM.generate(a,b,c,d)}request(a,b=null){return new cn(this.makeRequest(a,b))}async makeRequest(a,b){let c=await a,d=c.maxRetries??this.maxRetries;null==b&&(b=d),await this.prepareOptions(c);let{req:e,url:f,timeout:g}=this.buildRequest(c,{retryCount:d-b});if(await this.prepareRequest(e,{url:f,options:c}),cI("request",f,c,e.headers),c.signal?.aborted)throw new bN;let h=new AbortController,i=await this.fetchWithTimeout(f,e,g,h).catch(cC);if(i instanceof Error){if(c.signal?.aborted)throw new bN;if(b)return this.retryRequest(c,b);if("AbortError"===i.name)throw new bP;throw new bO({cause:i})}let j=cr(i.headers);if(!i.ok){if(b&&this.shouldRetry(i)){let a=`retrying, ${b} attempts remaining`;return cI(`response (error; ${a})`,i.status,f,j),this.retryRequest(c,b,j)}let a=await i.text().catch(a=>cC(a).message),d=cx(a),e=d?void 0:a,g=b?"(error; no more retries left)":"(error; not retryable)";throw cI(`response (error; ${g})`,i.status,f,j,e),this.makeStatusError(i.status,d,e,j)}return{response:i,options:c,controller:h}}requestAPIList(a,b){return new cq(this,this.makeRequest(b,null),a)}buildURL(a,b){let c=new URL(cz(a)?a:this.baseURL+(this.baseURL.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),d=this.defaultQuery();return cE(d)||(b={...d,...b}),"object"==typeof b&&b&&!Array.isArray(b)&&(c.search=this.stringifyQuery(b)),c.toString()}stringifyQuery(a){return Object.entries(a).filter(([a,b])=>void 0!==b).map(([a,b])=>{if("string"==typeof b||"number"==typeof b||"boolean"==typeof b)return`${encodeURIComponent(a)}=${encodeURIComponent(b)}`;if(null===b)return`${encodeURIComponent(a)}=`;throw new bL(`Cannot stringify type ${typeof b}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(a,b,c,d){let{signal:e,...f}=b||{};e&&e.addEventListener("abort",()=>d.abort());let g=setTimeout(()=>d.abort(),c),h={signal:d.signal,...f};return h.method&&(h.method=h.method.toUpperCase()),this.fetch.call(void 0,a,h).finally(()=>{clearTimeout(g)})}shouldRetry(a){let b=a.headers.get("x-should-retry");return"true"===b||"false"!==b&&(408===a.status||409===a.status||429===a.status||!!(a.status>=500))}async retryRequest(a,b,c){let d,e=c?.["retry-after-ms"];if(e){let a=parseFloat(e);Number.isNaN(a)||(d=a)}let f=c?.["retry-after"];if(f&&!d){let a=parseFloat(f);d=Number.isNaN(a)?Date.parse(f)-Date.now():1e3*a}if(!(d&&0<=d&&d<6e4)){let c=a.maxRetries??this.maxRetries;d=this.calculateDefaultRetryTimeoutMillis(b,c)}return await cA(d),this.makeRequest(a,b-1)}calculateDefaultRetryTimeoutMillis(a,b){return Math.min(.5*Math.pow(2,b-a),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${be}`}}class cp{constructor(a,b,c,d){B.set(this,void 0),cj(this,B,a,"f"),this.options=d,this.response=b,this.body=c}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){let a=this.nextPageInfo();if(!a)throw new bL("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let b={...this.options};if("params"in a&&"object"==typeof b.query)b.query={...b.query,...a.params};else if("url"in a){for(let[c,d]of[...Object.entries(b.query||{}),...a.url.searchParams.entries()])a.url.searchParams.set(c,d);b.query=void 0,b.path=a.url.toString()}return await ck(this,B,"f").requestAPIList(this.constructor,b)}async *iterPages(){let a=this;for(yield a;a.hasNextPage();)a=await a.getNextPage(),yield a}async *[(B=new WeakMap,Symbol.asyncIterator)](){for await(let a of this.iterPages())for(let b of a.getPaginatedItems())yield b}}class cq extends cn{constructor(a,b,c){super(b,async b=>new c(a,b.response,await cl(b),b.options))}async *[Symbol.asyncIterator](){for await(let a of(await this))yield a}}let cr=a=>new Proxy(Object.fromEntries(a.entries()),{get(a,b){let c=b.toString();return a[c.toLowerCase()]||a[c]}}),cs={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ct=a=>"object"==typeof a&&null!==a&&!cE(a)&&Object.keys(a).every(a=>cF(cs,a)),cu=a=>"x32"===a?"x32":"x86_64"===a||"x64"===a?"x64":"arm"===a?"arm":"aarch64"===a||"arm64"===a?"arm64":a?`other:${a}`:"unknown",cv=a=>(a=a.toLowerCase()).includes("ios")?"iOS":"android"===a?"Android":"darwin"===a?"MacOS":"win32"===a?"Windows":"freebsd"===a?"FreeBSD":"openbsd"===a?"OpenBSD":"linux"===a?"Linux":a?`Other:${a}`:"Unknown",cw=()=>d??(d=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":cv(Deno.build.os),"X-Stainless-Arch":cu(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":cv(process.platform),"X-Stainless-Arch":cu(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let a=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:a,pattern:b}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let c=b.exec(navigator.userAgent);if(c){let b=c[1]||0,d=c[2]||0,e=c[3]||0;return{browser:a,version:`${b}.${d}.${e}`}}}return null}();return a?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${a.browser}`,"X-Stainless-Runtime-Version":a.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),cx=a=>{try{return JSON.parse(a)}catch(a){return}},cy=/^[a-z][a-z0-9+.-]*:/i,cz=a=>cy.test(a),cA=a=>new Promise(b=>setTimeout(b,a)),cB=(a,b)=>{if("number"!=typeof b||!Number.isInteger(b))throw new bL(`${a} must be an integer`);if(b<0)throw new bL(`${a} must be a positive integer`);return b},cC=a=>{if(a instanceof Error)return a;if("object"==typeof a&&null!==a)try{return Error(JSON.stringify(a))}catch{}return Error(a)},cD=a=>"undefined"!=typeof process?process.env?.[a]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(a)?.trim():void 0;function cE(a){if(!a)return!0;for(let b in a)return!1;return!0}function cF(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function cG(a,b){for(let c in b){if(!cF(b,c))continue;let d=c.toLowerCase();if(!d)continue;let e=b[c];null===e?delete a[d]:void 0!==e&&(a[d]=e)}}let cH=new Set(["authorization","api-key"]);function cI(a,...b){"undefined"!=typeof process&&process?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${a}`,...b.map(a=>{if(!a)return a;if(a.headers){let b={...a,headers:{...a.headers}};for(let c in a.headers)cH.has(c.toLowerCase())&&(b.headers[c]="REDACTED");return b}let b=null;for(let c in a)cH.has(c.toLowerCase())&&(b??(b={...a}),b[c]="REDACTED");return b??a}))}let cJ=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)}),cK=(a,b)=>{let c=b.toLowerCase();if("function"==typeof a?.get){let d=b[0]?.toUpperCase()+b.substring(1).replace(/([^\w])(\w)/g,(a,b,c)=>b+c.toUpperCase());for(let e of[b,c,b.toUpperCase(),d]){let b=a.get(e);if(b)return b}}for(let[d,e]of Object.entries(a))if(d.toLowerCase()===c){if(Array.isArray(e)){if(e.length<=1)return e[0];return console.warn(`Received ${e.length} entries for the ${b} header, using the first entry.`),e[0]}return e}};function cL(a){return null!=a&&"object"==typeof a&&!Array.isArray(a)}class cM{constructor(a){this._client=a}}class cN extends cM{create(a,b){return this._client.post("/completions",{body:a,...b,stream:a.stream??!1})}}class cO extends cM{list(a,b={},c){return ct(b)?this.list(a,{},b):this._client.getAPIList(`/chat/completions/${a}/messages`,cT,{query:b,...c})}}class cP extends cp{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.object=c.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class cQ extends cp{constructor(a,b,c,d){super(a,b,c,d),this.data=c.data||[],this.has_more=c.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){let a=this.nextPageInfo();if(!a)return null;if("params"in a)return a.params;let b=Object.fromEntries(a.url.searchParams);return Object.keys(b).length?b:null}nextPageInfo(){let a=this.getPaginatedItems();if(!a.length)return null;let b=a[a.length-1]?.id;return b?{params:{after:b}}:null}}class cR extends cM{constructor(){super(...arguments),this.messages=new cO(this._client)}create(a,b){return this._client.post("/chat/completions",{body:a,...b,stream:a.stream??!1})}retrieve(a,b){return this._client.get(`/chat/completions/${a}`,b)}update(a,b,c){return this._client.post(`/chat/completions/${a}`,{body:b,...c})}list(a={},b){return ct(a)?this.list({},a):this._client.getAPIList("/chat/completions",cS,{query:a,...b})}del(a,b){return this._client.delete(`/chat/completions/${a}`,b)}}class cS extends cQ{}class cT extends cQ{}cR.ChatCompletionsPage=cS,cR.Messages=cO;class cU extends cM{constructor(){super(...arguments),this.completions=new cR(this._client)}}cU.Completions=cR,cU.ChatCompletionsPage=cS;class cV extends cM{create(a,b){let c=!!a.encoding_format,d=c?a.encoding_format:"base64";c&&cI("Request","User defined encoding_format:",a.encoding_format);let e=this._client.post("/embeddings",{body:{...a,encoding_format:d},...b});return c?e:(cI("response","Decoding base64 embeddings to float32 array"),e._thenUnwrap(a=>(a&&a.data&&a.data.forEach(a=>{let b=a.embedding;a.embedding=(a=>{if("undefined"!=typeof Buffer){let b=Buffer.from(a,"base64");return Array.from(new Float32Array(b.buffer,b.byteOffset,b.length/Float32Array.BYTES_PER_ELEMENT))}{let b=atob(a),c=b.length,d=new Uint8Array(c);for(let a=0;a<c;a++)d[a]=b.charCodeAt(a);return Array.from(new Float32Array(d.buffer))}})(b)}),a)))}}class cW extends cM{create(a,b){return this._client.post("/files",cf({body:a,...b}))}retrieve(a,b){return this._client.get(`/files/${a}`,b)}list(a={},b){return ct(a)?this.list({},a):this._client.getAPIList("/files",cX,{query:a,...b})}del(a,b){return this._client.delete(`/files/${a}`,b)}content(a,b){return this._client.get(`/files/${a}/content`,{...b,headers:{Accept:"application/binary",...b?.headers},__binaryResponse:!0})}retrieveContent(a,b){return this._client.get(`/files/${a}/content`,b)}async waitForProcessing(a,{pollInterval:b=5e3,maxWait:c=18e5}={}){let d=new Set(["processed","error","deleted"]),e=Date.now(),f=await this.retrieve(a);for(;!f.status||!d.has(f.status);)if(await cA(b),f=await this.retrieve(a),Date.now()-e>c)throw new bP({message:`Giving up on waiting for file ${a} to finish processing after ${c} milliseconds.`});return f}}class cX extends cQ{}cW.FileObjectsPage=cX;class cY extends cM{createVariation(a,b){return this._client.post("/images/variations",cf({body:a,...b}))}edit(a,b){return this._client.post("/images/edits",cf({body:a,...b}))}generate(a,b){return this._client.post("/images/generations",{body:a,...b})}}class cZ extends cM{create(a,b){return this._client.post("/audio/speech",{body:a,...b,headers:{Accept:"application/octet-stream",...b?.headers},__binaryResponse:!0})}}class c$ extends cM{create(a,b){return this._client.post("/audio/transcriptions",cf({body:a,...b,stream:a.stream??!1,__metadata:{model:a.model}}))}}class c_ extends cM{create(a,b){return this._client.post("/audio/translations",cf({body:a,...b,__metadata:{model:a.model}}))}}class c0 extends cM{constructor(){super(...arguments),this.transcriptions=new c$(this._client),this.translations=new c_(this._client),this.speech=new cZ(this._client)}}c0.Transcriptions=c$,c0.Translations=c_,c0.Speech=cZ;class c1 extends cM{create(a,b){return this._client.post("/moderations",{body:a,...b})}}class c2 extends cM{retrieve(a,b){return this._client.get(`/models/${a}`,b)}list(a){return this._client.getAPIList("/models",c3,a)}del(a,b){return this._client.delete(`/models/${a}`,b)}}class c3 extends cP{}c2.ModelsPage=c3;class c4 extends cM{}class c5 extends cM{run(a,b){return this._client.post("/fine_tuning/alpha/graders/run",{body:a,...b})}validate(a,b){return this._client.post("/fine_tuning/alpha/graders/validate",{body:a,...b})}}class c6 extends cM{constructor(){super(...arguments),this.graders=new c5(this._client)}}c6.Graders=c5;class c7 extends cM{create(a,b,c){return this._client.getAPIList(`/fine_tuning/checkpoints/${a}/permissions`,c8,{body:b,method:"post",...c})}retrieve(a,b={},c){return ct(b)?this.retrieve(a,{},b):this._client.get(`/fine_tuning/checkpoints/${a}/permissions`,{query:b,...c})}del(a,b,c){return this._client.delete(`/fine_tuning/checkpoints/${a}/permissions/${b}`,c)}}class c8 extends cP{}c7.PermissionCreateResponsesPage=c8;class c9 extends cM{constructor(){super(...arguments),this.permissions=new c7(this._client)}}c9.Permissions=c7,c9.PermissionCreateResponsesPage=c8;class da extends cM{list(a,b={},c){return ct(b)?this.list(a,{},b):this._client.getAPIList(`/fine_tuning/jobs/${a}/checkpoints`,db,{query:b,...c})}}class db extends cQ{}da.FineTuningJobCheckpointsPage=db;class dc extends cM{constructor(){super(...arguments),this.checkpoints=new da(this._client)}create(a,b){return this._client.post("/fine_tuning/jobs",{body:a,...b})}retrieve(a,b){return this._client.get(`/fine_tuning/jobs/${a}`,b)}list(a={},b){return ct(a)?this.list({},a):this._client.getAPIList("/fine_tuning/jobs",dd,{query:a,...b})}cancel(a,b){return this._client.post(`/fine_tuning/jobs/${a}/cancel`,b)}listEvents(a,b={},c){return ct(b)?this.listEvents(a,{},b):this._client.getAPIList(`/fine_tuning/jobs/${a}/events`,de,{query:b,...c})}pause(a,b){return this._client.post(`/fine_tuning/jobs/${a}/pause`,b)}resume(a,b){return this._client.post(`/fine_tuning/jobs/${a}/resume`,b)}}class dd extends cQ{}class de extends cQ{}dc.FineTuningJobsPage=dd,dc.FineTuningJobEventsPage=de,dc.Checkpoints=da,dc.FineTuningJobCheckpointsPage=db;class df extends cM{constructor(){super(...arguments),this.methods=new c4(this._client),this.jobs=new dc(this._client),this.checkpoints=new c9(this._client),this.alpha=new c6(this._client)}}df.Methods=c4,df.Jobs=dc,df.FineTuningJobsPage=dd,df.FineTuningJobEventsPage=de,df.Checkpoints=c9,df.Alpha=c6;class dg extends cM{}class dh extends cM{constructor(){super(...arguments),this.graderModels=new dg(this._client)}}dh.GraderModels=dg;let di=async a=>{let b=await Promise.allSettled(a),c=b.filter(a=>"rejected"===a.status);if(c.length){for(let a of c)console.error(a.reason);throw Error(`${c.length} promise(s) failed - see the above errors`)}let d=[];for(let a of b)"fulfilled"===a.status&&d.push(a.value);return d};class dj extends cM{create(a,b,c){return this._client.post(`/vector_stores/${a}/files`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}retrieve(a,b,c){return this._client.get(`/vector_stores/${a}/files/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}update(a,b,c,d){return this._client.post(`/vector_stores/${a}/files/${b}`,{body:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}list(a,b={},c){return ct(b)?this.list(a,{},b):this._client.getAPIList(`/vector_stores/${a}/files`,dk,{query:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}del(a,b,c){return this._client.delete(`/vector_stores/${a}/files/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}async createAndPoll(a,b,c){let d=await this.create(a,b,c);return await this.poll(a,d.id,c)}async poll(a,b,c){let d={...c?.headers,"X-Stainless-Poll-Helper":"true"};for(c?.pollIntervalMs&&(d["X-Stainless-Custom-Poll-Interval"]=c.pollIntervalMs.toString());;){let e=await this.retrieve(a,b,{...c,headers:d}).withResponse(),f=e.data;switch(f.status){case"in_progress":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=e.response.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await cA(g);break;case"failed":case"completed":return f}}}async upload(a,b,c){let d=await this._client.files.create({file:b,purpose:"assistants"},c);return this.create(a,{file_id:d.id},c)}async uploadAndPoll(a,b,c){let d=await this.upload(a,b,c);return await this.poll(a,d.id,c)}content(a,b,c){return this._client.getAPIList(`/vector_stores/${a}/files/${b}/content`,dl,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}}class dk extends cQ{}class dl extends cP{}dj.VectorStoreFilesPage=dk,dj.FileContentResponsesPage=dl;class dm extends cM{create(a,b,c){return this._client.post(`/vector_stores/${a}/file_batches`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}retrieve(a,b,c){return this._client.get(`/vector_stores/${a}/file_batches/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}cancel(a,b,c){return this._client.post(`/vector_stores/${a}/file_batches/${b}/cancel`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}async createAndPoll(a,b,c){let d=await this.create(a,b);return await this.poll(a,d.id,c)}listFiles(a,b,c={},d){return ct(c)?this.listFiles(a,b,{},c):this._client.getAPIList(`/vector_stores/${a}/file_batches/${b}/files`,dk,{query:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}async poll(a,b,c){let d={...c?.headers,"X-Stainless-Poll-Helper":"true"};for(c?.pollIntervalMs&&(d["X-Stainless-Custom-Poll-Interval"]=c.pollIntervalMs.toString());;){let{data:e,response:f}=await this.retrieve(a,b,{...c,headers:d}).withResponse();switch(e.status){case"in_progress":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=f.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await cA(g);break;case"failed":case"cancelled":case"completed":return e}}}async uploadAndPoll(a,{files:b,fileIds:c=[]},d){if(null==b||0==b.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let e=Math.min(d?.maxConcurrency??5,b.length),f=this._client,g=b.values(),h=[...c];async function i(a){for(let b of a){let a=await f.files.create({file:b,purpose:"assistants"},d);h.push(a.id)}}let j=Array(e).fill(g).map(i);return await di(j),await this.createAndPoll(a,{file_ids:h})}}class dn extends cM{constructor(){super(...arguments),this.files=new dj(this._client),this.fileBatches=new dm(this._client)}create(a,b){return this._client.post("/vector_stores",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}retrieve(a,b){return this._client.get(`/vector_stores/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}update(a,b,c){return this._client.post(`/vector_stores/${a}`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}list(a={},b){return ct(a)?this.list({},a):this._client.getAPIList("/vector_stores",dp,{query:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}del(a,b){return this._client.delete(`/vector_stores/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}search(a,b,c){return this._client.getAPIList(`/vector_stores/${a}/search`,dq,{body:b,method:"post",...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}}class dp extends cQ{}class dq extends cP{}dn.VectorStoresPage=dp,dn.VectorStoreSearchResponsesPage=dq,dn.Files=dj,dn.VectorStoreFilesPage=dk,dn.FileContentResponsesPage=dl,dn.FileBatches=dm;class dr extends cM{create(a,b){return this._client.post("/assistants",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}retrieve(a,b){return this._client.get(`/assistants/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}update(a,b,c){return this._client.post(`/assistants/${a}`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}list(a={},b){return ct(a)?this.list({},a):this._client.getAPIList("/assistants",ds,{query:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}del(a,b){return this._client.delete(`/assistants/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}}class ds extends cQ{}function dt(a){return"function"==typeof a.parse}dr.AssistantsPage=ds;let du=a=>a?.role==="assistant",dv=a=>a?.role==="function",dw=a=>a?.role==="tool";var dx=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},dy=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class dz{constructor(){C.add(this),this.controller=new AbortController,D.set(this,void 0),E.set(this,()=>{}),F.set(this,()=>{}),G.set(this,void 0),H.set(this,()=>{}),I.set(this,()=>{}),J.set(this,{}),K.set(this,!1),L.set(this,!1),M.set(this,!1),N.set(this,!1),dx(this,D,new Promise((a,b)=>{dx(this,E,a,"f"),dx(this,F,b,"f")}),"f"),dx(this,G,new Promise((a,b)=>{dx(this,H,a,"f"),dx(this,I,b,"f")}),"f"),dy(this,D,"f").catch(()=>{}),dy(this,G,"f").catch(()=>{})}_run(a){setTimeout(()=>{a().then(()=>{this._emitFinal(),this._emit("end")},dy(this,C,"m",O).bind(this))},0)}_connected(){this.ended||(dy(this,E,"f").call(this),this._emit("connect"))}get ended(){return dy(this,K,"f")}get errored(){return dy(this,L,"f")}get aborted(){return dy(this,M,"f")}abort(){this.controller.abort()}on(a,b){return(dy(this,J,"f")[a]||(dy(this,J,"f")[a]=[])).push({listener:b}),this}off(a,b){let c=dy(this,J,"f")[a];if(!c)return this;let d=c.findIndex(a=>a.listener===b);return d>=0&&c.splice(d,1),this}once(a,b){return(dy(this,J,"f")[a]||(dy(this,J,"f")[a]=[])).push({listener:b,once:!0}),this}emitted(a){return new Promise((b,c)=>{dx(this,N,!0,"f"),"error"!==a&&this.once("error",c),this.once(a,b)})}async done(){dx(this,N,!0,"f"),await dy(this,G,"f")}_emit(a,...b){if(dy(this,K,"f"))return;"end"===a&&(dx(this,K,!0,"f"),dy(this,H,"f").call(this));let c=dy(this,J,"f")[a];if(c&&(dy(this,J,"f")[a]=c.filter(a=>!a.once),c.forEach(({listener:a})=>a(...b))),"abort"===a){let a=b[0];dy(this,N,"f")||c?.length||Promise.reject(a),dy(this,F,"f").call(this,a),dy(this,I,"f").call(this,a),this._emit("end");return}if("error"===a){let a=b[0];dy(this,N,"f")||c?.length||Promise.reject(a),dy(this,F,"f").call(this,a),dy(this,I,"f").call(this,a),this._emit("end")}}_emitFinal(){}}function dA(a){return a?.$brand==="auto-parseable-response-format"}function dB(a){return a?.$brand==="auto-parseable-tool"}function dC(a,b){let c=a.choices.map(a=>{var c,d;if("length"===a.finish_reason)throw new bY;if("content_filter"===a.finish_reason)throw new bZ;return{...a,message:{...a.message,...a.message.tool_calls?{tool_calls:a.message.tool_calls?.map(a=>(function(a,b){let c=a.tools?.find(a=>a.function?.name===b.function.name);return{...b,function:{...b.function,parsed_arguments:dB(c)?c.$parseRaw(b.function.arguments):c?.function.strict?JSON.parse(b.function.arguments):null}}})(b,a))??void 0}:void 0,parsed:a.message.content&&!a.message.refusal?(c=b,d=a.message.content,c.response_format?.type!=="json_schema"?null:c.response_format?.type==="json_schema"?"$parseRaw"in c.response_format?c.response_format.$parseRaw(d):JSON.parse(d):null):null}}});return{...a,choices:c}}function dD(a){return!!dA(a.response_format)||(a.tools?.some(a=>dB(a)||"function"===a.type&&!0===a.function.strict)??!1)}D=new WeakMap,E=new WeakMap,F=new WeakMap,G=new WeakMap,H=new WeakMap,I=new WeakMap,J=new WeakMap,K=new WeakMap,L=new WeakMap,M=new WeakMap,N=new WeakMap,C=new WeakSet,O=function(a){if(dx(this,L,!0,"f"),a instanceof Error&&"AbortError"===a.name&&(a=new bN),a instanceof bN)return dx(this,M,!0,"f"),this._emit("abort",a);if(a instanceof bL)return this._emit("error",a);if(a instanceof Error){let b=new bL(a.message);return b.cause=a,this._emit("error",b)}return this._emit("error",new bL(String(a)))};var dE=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class dF extends dz{constructor(){super(...arguments),P.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(a){this._chatCompletions.push(a),this._emit("chatCompletion",a);let b=a.choices[0]?.message;return b&&this._addMessage(b),a}_addMessage(a,b=!0){if("content"in a||(a.content=null),this.messages.push(a),b){if(this._emit("message",a),(dv(a)||dw(a))&&a.content)this._emit("functionCallResult",a.content);else if(du(a)&&a.function_call)this._emit("functionCall",a.function_call);else if(du(a)&&a.tool_calls)for(let b of a.tool_calls)"function"===b.type&&this._emit("functionCall",b.function)}}async finalChatCompletion(){await this.done();let a=this._chatCompletions[this._chatCompletions.length-1];if(!a)throw new bL("stream ended without producing a ChatCompletion");return a}async finalContent(){return await this.done(),dE(this,P,"m",Q).call(this)}async finalMessage(){return await this.done(),dE(this,P,"m",R).call(this)}async finalFunctionCall(){return await this.done(),dE(this,P,"m",S).call(this)}async finalFunctionCallResult(){return await this.done(),dE(this,P,"m",T).call(this)}async totalUsage(){return await this.done(),dE(this,P,"m",U).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let a=this._chatCompletions[this._chatCompletions.length-1];a&&this._emit("finalChatCompletion",a);let b=dE(this,P,"m",R).call(this);b&&this._emit("finalMessage",b);let c=dE(this,P,"m",Q).call(this);c&&this._emit("finalContent",c);let d=dE(this,P,"m",S).call(this);d&&this._emit("finalFunctionCall",d);let e=dE(this,P,"m",T).call(this);null!=e&&this._emit("finalFunctionCallResult",e),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",dE(this,P,"m",U).call(this))}async _createChatCompletion(a,b,c){let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),dE(this,P,"m",V).call(this,b);let e=await a.chat.completions.create({...b,stream:!1},{...c,signal:this.controller.signal});return this._connected(),this._addChatCompletion(dC(e,b))}async _runChatCompletion(a,b,c){for(let a of b.messages)this._addMessage(a,!1);return await this._createChatCompletion(a,b,c)}async _runFunctions(a,b,c){let d="function",{function_call:e="auto",stream:f,...g}=b,h="string"!=typeof e&&e?.name,{maxChatCompletions:i=10}=c||{},j={};for(let a of b.functions)j[a.name||a.function.name]=a;let k=b.functions.map(a=>({name:a.name||a.function.name,parameters:a.parameters,description:a.description}));for(let a of b.messages)this._addMessage(a,!1);for(let b=0;b<i;++b){let b,f=await this._createChatCompletion(a,{...g,function_call:e,functions:k,messages:[...this.messages]},c),i=f.choices[0]?.message;if(!i)throw new bL("missing message in ChatCompletion response");if(!i.function_call)return;let{name:l,arguments:m}=i.function_call,n=j[l];if(n){if(h&&h!==l){let a=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(h)} requested. Please try again`;this._addMessage({role:d,name:l,content:a});continue}}else{let a=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${k.map(a=>JSON.stringify(a.name)).join(", ")}. Please try again`;this._addMessage({role:d,name:l,content:a});continue}try{b=dt(n)?await n.parse(m):m}catch(a){this._addMessage({role:d,name:l,content:a instanceof Error?a.message:String(a)});continue}let o=await n.function(b,this),p=dE(this,P,"m",W).call(this,o);if(this._addMessage({role:d,name:l,content:p}),h)return}}async _runTools(a,b,c){let d="tool",{tool_choice:e="auto",stream:f,...g}=b,h="string"!=typeof e&&e?.function?.name,{maxChatCompletions:i=10}=c||{},j=b.tools.map(a=>{if(dB(a)){if(!a.$callback)throw new bL("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:a.$callback,name:a.function.name,description:a.function.description||"",parameters:a.function.parameters,parse:a.$parseRaw,strict:!0}}}return a}),k={};for(let a of j)"function"===a.type&&(k[a.function.name||a.function.function.name]=a.function);let l="tools"in b?j.map(a=>"function"===a.type?{type:"function",function:{name:a.function.name||a.function.function.name,parameters:a.function.parameters,description:a.function.description,strict:a.function.strict}}:a):void 0;for(let a of b.messages)this._addMessage(a,!1);for(let b=0;b<i;++b){let b=await this._createChatCompletion(a,{...g,tool_choice:e,tools:l,messages:[...this.messages]},c),f=b.choices[0]?.message;if(!f)throw new bL("missing message in ChatCompletion response");if(!f.tool_calls?.length)break;for(let a of f.tool_calls){let b;if("function"!==a.type)continue;let c=a.id,{name:e,arguments:f}=a.function,g=k[e];if(g){if(h&&h!==e){let a=`Invalid tool_call: ${JSON.stringify(e)}. ${JSON.stringify(h)} requested. Please try again`;this._addMessage({role:d,tool_call_id:c,content:a});continue}}else{let a=`Invalid tool_call: ${JSON.stringify(e)}. Available options are: ${Object.keys(k).map(a=>JSON.stringify(a)).join(", ")}. Please try again`;this._addMessage({role:d,tool_call_id:c,content:a});continue}try{b=dt(g)?await g.parse(f):f}catch(b){let a=b instanceof Error?b.message:String(b);this._addMessage({role:d,tool_call_id:c,content:a});continue}let i=await g.function(b,this),j=dE(this,P,"m",W).call(this,i);if(this._addMessage({role:d,tool_call_id:c,content:j}),h)return}}}}P=new WeakSet,Q=function(){return dE(this,P,"m",R).call(this).content??null},R=function(){let a=this.messages.length;for(;a-- >0;){let b=this.messages[a];if(du(b)){let{function_call:a,...c}=b,d={...c,content:b.content??null,refusal:b.refusal??null};return a&&(d.function_call=a),d}}throw new bL("stream ended without producing a ChatCompletionMessage with role=assistant")},S=function(){for(let a=this.messages.length-1;a>=0;a--){let b=this.messages[a];if(du(b)&&b?.function_call)return b.function_call;if(du(b)&&b?.tool_calls?.length)return b.tool_calls.at(-1)?.function}},T=function(){for(let a=this.messages.length-1;a>=0;a--){let b=this.messages[a];if(dv(b)&&null!=b.content||dw(b)&&null!=b.content&&"string"==typeof b.content&&this.messages.some(a=>"assistant"===a.role&&a.tool_calls?.some(a=>"function"===a.type&&a.id===b.tool_call_id)))return b.content}},U=function(){let a={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:b}of this._chatCompletions)b&&(a.completion_tokens+=b.completion_tokens,a.prompt_tokens+=b.prompt_tokens,a.total_tokens+=b.total_tokens);return a},V=function(a){if(null!=a.n&&a.n>1)throw new bL("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},W=function(a){return"string"==typeof a?a:void 0===a?"undefined":JSON.stringify(a)};class dG extends dF{static runFunctions(a,b,c){let d=new dG,e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return d._run(()=>d._runFunctions(a,b,e)),d}static runTools(a,b,c){let d=new dG,e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runTools"}};return d._run(()=>d._runTools(a,b,e)),d}_addMessage(a,b=!0){super._addMessage(a,b),du(a)&&a.content&&this._emit("content",a.content)}}let dH={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,ALL:511};class dI extends Error{}class dJ extends Error{}let dK=a=>(function(a,b=dH.ALL){if("string"!=typeof a)throw TypeError(`expecting str, got ${typeof a}`);if(!a.trim())throw Error(`${a} is empty`);return((a,b)=>{let c=a.length,d=0,e=a=>{throw new dI(`${a} at position ${d}`)},f=a=>{throw new dJ(`${a} at position ${d}`)},g=()=>(l(),d>=c&&e("Unexpected end of input"),'"'===a[d])?h():"{"===a[d]?i():"["===a[d]?j():"null"===a.substring(d,d+4)||dH.NULL&b&&c-d<4&&"null".startsWith(a.substring(d))?(d+=4,null):"true"===a.substring(d,d+4)||dH.BOOL&b&&c-d<4&&"true".startsWith(a.substring(d))?(d+=4,!0):"false"===a.substring(d,d+5)||dH.BOOL&b&&c-d<5&&"false".startsWith(a.substring(d))?(d+=5,!1):"Infinity"===a.substring(d,d+8)||dH.INFINITY&b&&c-d<8&&"Infinity".startsWith(a.substring(d))?(d+=8,1/0):"-Infinity"===a.substring(d,d+9)||dH.MINUS_INFINITY&b&&1<c-d&&c-d<9&&"-Infinity".startsWith(a.substring(d))?(d+=9,-1/0):"NaN"===a.substring(d,d+3)||dH.NAN&b&&c-d<3&&"NaN".startsWith(a.substring(d))?(d+=3,NaN):k(),h=()=>{let g=d,h=!1;for(d++;d<c&&('"'!==a[d]||h&&"\\"===a[d-1]);)h="\\"===a[d]&&!h,d++;if('"'==a.charAt(d))try{return JSON.parse(a.substring(g,++d-Number(h)))}catch(a){f(String(a))}else if(dH.STR&b)try{return JSON.parse(a.substring(g,d-Number(h))+'"')}catch(b){return JSON.parse(a.substring(g,a.lastIndexOf("\\"))+'"')}e("Unterminated string literal")},i=()=>{d++,l();let f={};try{for(;"}"!==a[d];){if(l(),d>=c&&dH.OBJ&b)return f;let e=h();l(),d++;try{let a=g();Object.defineProperty(f,e,{value:a,writable:!0,enumerable:!0,configurable:!0})}catch(a){if(dH.OBJ&b)return f;throw a}l(),","===a[d]&&d++}}catch(a){if(dH.OBJ&b)return f;e("Expected '}' at end of object")}return d++,f},j=()=>{d++;let c=[];try{for(;"]"!==a[d];)c.push(g()),l(),","===a[d]&&d++}catch(a){if(dH.ARR&b)return c;e("Expected ']' at end of array")}return d++,c},k=()=>{if(0===d){"-"===a&&dH.NUM&b&&e("Not sure what '-' is");try{return JSON.parse(a)}catch(c){if(dH.NUM&b)try{if("."===a[a.length-1])return JSON.parse(a.substring(0,a.lastIndexOf(".")));return JSON.parse(a.substring(0,a.lastIndexOf("e")))}catch(a){}f(String(c))}}let g=d;for("-"===a[d]&&d++;a[d]&&!",]}".includes(a[d]);)d++;d!=c||dH.NUM&b||e("Unterminated number literal");try{return JSON.parse(a.substring(g,d))}catch(c){"-"===a.substring(g,d)&&dH.NUM&b&&e("Not sure what '-' is");try{return JSON.parse(a.substring(g,a.lastIndexOf("e")))}catch(a){f(String(a))}}},l=()=>{for(;d<c&&" \n\r	".includes(a[d]);)d++};return g()})(a.trim(),b)})(a,dH.ALL^dH.NUM);var dL=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},dM=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class dN extends dF{constructor(a){super(),X.add(this),Y.set(this,void 0),Z.set(this,void 0),$.set(this,void 0),dL(this,Y,a,"f"),dL(this,Z,[],"f")}get currentChatCompletionSnapshot(){return dM(this,$,"f")}static fromReadableStream(a){let b=new dN(null);return b._run(()=>b._fromReadableStream(a)),b}static createChatCompletion(a,b,c){let d=new dN(b);return d._run(()=>d._runChatCompletion(a,{...b,stream:!0},{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}async _createChatCompletion(a,b,c){super._createChatCompletion;let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),dM(this,X,"m",_).call(this);let e=await a.chat.completions.create({...b,stream:!0},{...c,signal:this.controller.signal});for await(let a of(this._connected(),e))dM(this,X,"m",ab).call(this,a);if(e.controller.signal?.aborted)throw new bN;return this._addChatCompletion(dM(this,X,"m",ae).call(this))}async _fromReadableStream(a,b){let c,d=b?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort())),dM(this,X,"m",_).call(this),this._connected();let e=b2.fromReadableStream(a,this.controller);for await(let a of e)c&&c!==a.id&&this._addChatCompletion(dM(this,X,"m",ae).call(this)),dM(this,X,"m",ab).call(this,a),c=a.id;if(e.controller.signal?.aborted)throw new bN;return this._addChatCompletion(dM(this,X,"m",ae).call(this))}[(Y=new WeakMap,Z=new WeakMap,$=new WeakMap,X=new WeakSet,_=function(){this.ended||dL(this,$,void 0,"f")},aa=function(a){let b=dM(this,Z,"f")[a.index];return b||(b={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},dM(this,Z,"f")[a.index]=b),b},ab=function(a){if(this.ended)return;let b=dM(this,X,"m",ag).call(this,a);for(let c of(this._emit("chunk",a,b),a.choices)){let a=b.choices[c.index];null!=c.delta.content&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",c.delta.content,a.message.content),this._emit("content.delta",{delta:c.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),null!=c.delta.refusal&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:c.delta.refusal,snapshot:a.message.refusal}),c.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:c.logprobs?.content,snapshot:a.logprobs?.content??[]}),c.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:c.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});let d=dM(this,X,"m",aa).call(this,a);for(let b of(a.finish_reason&&(dM(this,X,"m",ad).call(this,a),null!=d.current_tool_call_index&&dM(this,X,"m",ac).call(this,a,d.current_tool_call_index)),c.delta.tool_calls??[]))d.current_tool_call_index!==b.index&&(dM(this,X,"m",ad).call(this,a),null!=d.current_tool_call_index&&dM(this,X,"m",ac).call(this,a,d.current_tool_call_index)),d.current_tool_call_index=b.index;for(let b of c.delta.tool_calls??[]){let c=a.message.tool_calls?.[b.index];c?.type&&(c?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:c.function?.name,index:b.index,arguments:c.function.arguments,parsed_arguments:c.function.parsed_arguments,arguments_delta:b.function?.arguments??""}):c?.type)}}},ac=function(a,b){if(dM(this,X,"m",aa).call(this,a).done_tool_calls.has(b))return;let c=a.message.tool_calls?.[b];if(!c)throw Error("no tool call snapshot");if(!c.type)throw Error("tool call snapshot missing `type`");if("function"===c.type){let a=dM(this,Y,"f")?.tools?.find(a=>"function"===a.type&&a.function.name===c.function.name);this._emit("tool_calls.function.arguments.done",{name:c.function.name,index:b,arguments:c.function.arguments,parsed_arguments:dB(a)?a.$parseRaw(c.function.arguments):a?.function.strict?JSON.parse(c.function.arguments):null})}else c.type},ad=function(a){let b=dM(this,X,"m",aa).call(this,a);if(a.message.content&&!b.content_done){b.content_done=!0;let c=dM(this,X,"m",af).call(this);this._emit("content.done",{content:a.message.content,parsed:c?c.$parseRaw(a.message.content):null})}a.message.refusal&&!b.refusal_done&&(b.refusal_done=!0,this._emit("refusal.done",{refusal:a.message.refusal})),a.logprobs?.content&&!b.logprobs_content_done&&(b.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:a.logprobs.content})),a.logprobs?.refusal&&!b.logprobs_refusal_done&&(b.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:a.logprobs.refusal}))},ae=function(){if(this.ended)throw new bL("stream has ended, this shouldn't happen");let a=dM(this,$,"f");if(!a)throw new bL("request ended without sending any chunks");return dL(this,$,void 0,"f"),dL(this,Z,[],"f"),function(a,b){var c;let{id:d,choices:e,created:f,model:g,system_fingerprint:h,...i}=a;return c={...i,id:d,choices:e.map(({message:b,finish_reason:c,index:d,logprobs:e,...f})=>{if(!c)throw new bL(`missing finish_reason for choice ${d}`);let{content:g=null,function_call:h,tool_calls:i,...j}=b,k=b.role;if(!k)throw new bL(`missing role for choice ${d}`);if(h){let{arguments:a,name:i}=h;if(null==a)throw new bL(`missing function_call.arguments for choice ${d}`);if(!i)throw new bL(`missing function_call.name for choice ${d}`);return{...f,message:{content:g,function_call:{arguments:a,name:i},role:k,refusal:b.refusal??null},finish_reason:c,index:d,logprobs:e}}return i?{...f,index:d,finish_reason:c,logprobs:e,message:{...j,role:k,content:g,refusal:b.refusal??null,tool_calls:i.map((b,c)=>{let{function:e,type:f,id:g,...h}=b,{arguments:i,name:j,...k}=e||{};if(null==g)throw new bL(`missing choices[${d}].tool_calls[${c}].id
${dO(a)}`);if(null==f)throw new bL(`missing choices[${d}].tool_calls[${c}].type
${dO(a)}`);if(null==j)throw new bL(`missing choices[${d}].tool_calls[${c}].function.name
${dO(a)}`);if(null==i)throw new bL(`missing choices[${d}].tool_calls[${c}].function.arguments
${dO(a)}`);return{...h,id:g,type:f,function:{...k,name:j,arguments:i}}})}}:{...f,message:{...j,content:g,role:k,refusal:b.refusal??null},finish_reason:c,index:d,logprobs:e}}),created:f,model:g,object:"chat.completion",...h?{system_fingerprint:h}:{}},b&&dD(b)?dC(c,b):{...c,choices:c.choices.map(a=>({...a,message:{...a.message,parsed:null,...a.message.tool_calls?{tool_calls:a.message.tool_calls}:void 0}}))}}(a,dM(this,Y,"f"))},af=function(){let a=dM(this,Y,"f")?.response_format;return dA(a)?a:null},ag=function(a){var b,c,d,e;let f=dM(this,$,"f"),{choices:g,...h}=a;for(let{delta:g,finish_reason:i,index:j,logprobs:k=null,...l}of(f?Object.assign(f,h):f=dL(this,$,{...h,choices:[]},"f"),a.choices)){let a=f.choices[j];if(a||(a=f.choices[j]={finish_reason:i,index:j,message:{},logprobs:k,...l}),k)if(a.logprobs){let{content:d,refusal:e,...f}=k;Object.assign(a.logprobs,f),d&&((b=a.logprobs).content??(b.content=[]),a.logprobs.content.push(...d)),e&&((c=a.logprobs).refusal??(c.refusal=[]),a.logprobs.refusal.push(...e))}else a.logprobs=Object.assign({},k);if(i&&(a.finish_reason=i,dM(this,Y,"f")&&dD(dM(this,Y,"f")))){if("length"===i)throw new bY;if("content_filter"===i)throw new bZ}if(Object.assign(a,l),!g)continue;let{content:h,refusal:m,function_call:n,role:o,tool_calls:p,...q}=g;if(Object.assign(a.message,q),m&&(a.message.refusal=(a.message.refusal||"")+m),o&&(a.message.role=o),n&&(a.message.function_call?(n.name&&(a.message.function_call.name=n.name),n.arguments&&((d=a.message.function_call).arguments??(d.arguments=""),a.message.function_call.arguments+=n.arguments)):a.message.function_call=n),h&&(a.message.content=(a.message.content||"")+h,!a.message.refusal&&dM(this,X,"m",af).call(this)&&(a.message.parsed=dK(a.message.content))),p)for(let{index:b,id:c,type:d,function:f,...g}of(a.message.tool_calls||(a.message.tool_calls=[]),p)){let h=(e=a.message.tool_calls)[b]??(e[b]={});Object.assign(h,g),c&&(h.id=c),d&&(h.type=d),f&&(h.function??(h.function={name:f.name??"",arguments:""})),f?.name&&(h.function.name=f.name),f?.arguments&&(h.function.arguments+=f.arguments,function(a,b){if(!a)return!1;let c=a.tools?.find(a=>a.function?.name===b.function.name);return dB(c)||c?.function.strict||!1}(dM(this,Y,"f"),h)&&(h.function.parsed_arguments=dK(h.function.arguments)))}}return f},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("chunk",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new b2(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function dO(a){return JSON.stringify(a)}class dP extends dN{static fromReadableStream(a){let b=new dP(null);return b._run(()=>b._fromReadableStream(a)),b}static runFunctions(a,b,c){let d=new dP(null),e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return d._run(()=>d._runFunctions(a,b,e)),d}static runTools(a,b,c){let d=new dP(b),e={...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"runTools"}};return d._run(()=>d._runTools(a,b,e)),d}}class dQ extends cM{parse(a,b){for(let b of a.tools??[]){if("function"!==b.type)throw new bL(`Currently only \`function\` tool types support auto-parsing; Received \`${b.type}\``);if(!0!==b.function.strict)throw new bL(`The \`${b.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(a,{...b,headers:{...b?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(b=>dC(b,a))}runFunctions(a,b){return a.stream?dP.runFunctions(this._client,a,b):dG.runFunctions(this._client,a,b)}runTools(a,b){return a.stream?dP.runTools(this._client,a,b):dG.runTools(this._client,a,b)}stream(a,b){return dN.createChatCompletion(this._client,a,b)}}class dR extends cM{constructor(){super(...arguments),this.completions=new dQ(this._client)}}(dR||(dR={})).Completions=dQ;class dS extends cM{create(a,b){return this._client.post("/realtime/sessions",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}}class dT extends cM{create(a,b){return this._client.post("/realtime/transcription_sessions",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}}class dU extends cM{constructor(){super(...arguments),this.sessions=new dS(this._client),this.transcriptionSessions=new dT(this._client)}}dU.Sessions=dS,dU.TranscriptionSessions=dT;var dV=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)},dW=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c};class dX extends dz{constructor(){super(...arguments),ah.add(this),ai.set(this,[]),aj.set(this,{}),ak.set(this,{}),al.set(this,void 0),am.set(this,void 0),an.set(this,void 0),ao.set(this,void 0),ap.set(this,void 0),aq.set(this,void 0),ar.set(this,void 0),as.set(this,void 0),at.set(this,void 0)}[(ai=new WeakMap,aj=new WeakMap,ak=new WeakMap,al=new WeakMap,am=new WeakMap,an=new WeakMap,ao=new WeakMap,ap=new WeakMap,aq=new WeakMap,ar=new WeakMap,as=new WeakMap,at=new WeakMap,ah=new WeakSet,Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("event",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(a){let b=new dX;return b._run(()=>b._fromReadableStream(a)),b}async _fromReadableStream(a,b){let c=b?.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort())),this._connected();let d=b2.fromReadableStream(a,this.controller);for await(let a of d)dV(this,ah,"m",au).call(this,a);if(d.controller.signal?.aborted)throw new bN;return this._addRun(dV(this,ah,"m",av).call(this))}toReadableStream(){return new b2(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(a,b,c,d,e){let f=new dX;return f._run(()=>f._runToolAssistantStream(a,b,c,d,{...e,headers:{...e?.headers,"X-Stainless-Helper-Method":"stream"}})),f}async _createToolAssistantStream(a,b,c,d,e){let f=e?.signal;f&&(f.aborted&&this.controller.abort(),f.addEventListener("abort",()=>this.controller.abort()));let g={...d,stream:!0},h=await a.submitToolOutputs(b,c,g,{...e,signal:this.controller.signal});for await(let a of(this._connected(),h))dV(this,ah,"m",au).call(this,a);if(h.controller.signal?.aborted)throw new bN;return this._addRun(dV(this,ah,"m",av).call(this))}static createThreadAssistantStream(a,b,c){let d=new dX;return d._run(()=>d._threadAssistantStream(a,b,{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}static createAssistantStream(a,b,c,d){let e=new dX;return e._run(()=>e._runAssistantStream(a,b,c,{...d,headers:{...d?.headers,"X-Stainless-Helper-Method":"stream"}})),e}currentEvent(){return dV(this,ar,"f")}currentRun(){return dV(this,as,"f")}currentMessageSnapshot(){return dV(this,al,"f")}currentRunStepSnapshot(){return dV(this,at,"f")}async finalRunSteps(){return await this.done(),Object.values(dV(this,aj,"f"))}async finalMessages(){return await this.done(),Object.values(dV(this,ak,"f"))}async finalRun(){if(await this.done(),!dV(this,am,"f"))throw Error("Final run was not received.");return dV(this,am,"f")}async _createThreadAssistantStream(a,b,c){let d=c?.signal;d&&(d.aborted&&this.controller.abort(),d.addEventListener("abort",()=>this.controller.abort()));let e={...b,stream:!0},f=await a.createAndRun(e,{...c,signal:this.controller.signal});for await(let a of(this._connected(),f))dV(this,ah,"m",au).call(this,a);if(f.controller.signal?.aborted)throw new bN;return this._addRun(dV(this,ah,"m",av).call(this))}async _createAssistantStream(a,b,c,d){let e=d?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort()));let f={...c,stream:!0},g=await a.create(b,f,{...d,signal:this.controller.signal});for await(let a of(this._connected(),g))dV(this,ah,"m",au).call(this,a);if(g.controller.signal?.aborted)throw new bN;return this._addRun(dV(this,ah,"m",av).call(this))}static accumulateDelta(a,b){for(let[c,d]of Object.entries(b)){if(!a.hasOwnProperty(c)){a[c]=d;continue}let b=a[c];if(null==b||"index"===c||"type"===c){a[c]=d;continue}if("string"==typeof b&&"string"==typeof d)b+=d;else if("number"==typeof b&&"number"==typeof d)b+=d;else if(cL(b)&&cL(d))b=this.accumulateDelta(b,d);else if(Array.isArray(b)&&Array.isArray(d)){if(b.every(a=>"string"==typeof a||"number"==typeof a)){b.push(...d);continue}for(let a of d){if(!cL(a))throw Error(`Expected array delta entry to be an object but got: ${a}`);let c=a.index;if(null==c)throw console.error(a),Error("Expected array delta entry to have an `index` property");if("number"!=typeof c)throw Error(`Expected array delta entry \`index\` property to be a number but got ${c}`);let d=b[c];null==d?b.push(a):b[c]=this.accumulateDelta(d,a)}continue}else throw Error(`Unhandled record type: ${c}, deltaValue: ${d}, accValue: ${b}`);a[c]=b}return a}_addRun(a){return a}async _threadAssistantStream(a,b,c){return await this._createThreadAssistantStream(b,a,c)}async _runAssistantStream(a,b,c,d){return await this._createAssistantStream(b,a,c,d)}async _runToolAssistantStream(a,b,c,d,e){return await this._createToolAssistantStream(c,a,b,d,e)}}au=function(a){if(!this.ended)switch(dW(this,ar,a,"f"),dV(this,ah,"m",ay).call(this,a),a.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":dV(this,ah,"m",aC).call(this,a);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":dV(this,ah,"m",ax).call(this,a);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":dV(this,ah,"m",aw).call(this,a);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},av=function(){if(this.ended)throw new bL("stream has ended, this shouldn't happen");if(!dV(this,am,"f"))throw Error("Final run has not been received");return dV(this,am,"f")},aw=function(a){let[b,c]=dV(this,ah,"m",aA).call(this,a,dV(this,al,"f"));for(let a of(dW(this,al,b,"f"),dV(this,ak,"f")[b.id]=b,c)){let c=b.content[a.index];c?.type=="text"&&this._emit("textCreated",c.text)}switch(a.event){case"thread.message.created":this._emit("messageCreated",a.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",a.data.delta,b),a.data.delta.content)for(let c of a.data.delta.content){if("text"==c.type&&c.text){let a=c.text,d=b.content[c.index];if(d&&"text"==d.type)this._emit("textDelta",a,d.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(c.index!=dV(this,an,"f")){if(dV(this,ao,"f"))switch(dV(this,ao,"f").type){case"text":this._emit("textDone",dV(this,ao,"f").text,dV(this,al,"f"));break;case"image_file":this._emit("imageFileDone",dV(this,ao,"f").image_file,dV(this,al,"f"))}dW(this,an,c.index,"f")}dW(this,ao,b.content[c.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==dV(this,an,"f")){let b=a.data.content[dV(this,an,"f")];if(b)switch(b.type){case"image_file":this._emit("imageFileDone",b.image_file,dV(this,al,"f"));break;case"text":this._emit("textDone",b.text,dV(this,al,"f"))}}dV(this,al,"f")&&this._emit("messageDone",a.data),dW(this,al,void 0,"f")}},ax=function(a){let b=dV(this,ah,"m",az).call(this,a);switch(dW(this,at,b,"f"),a.event){case"thread.run.step.created":this._emit("runStepCreated",a.data);break;case"thread.run.step.delta":let c=a.data.delta;if(c.step_details&&"tool_calls"==c.step_details.type&&c.step_details.tool_calls&&"tool_calls"==b.step_details.type)for(let a of c.step_details.tool_calls)a.index==dV(this,ap,"f")?this._emit("toolCallDelta",a,b.step_details.tool_calls[a.index]):(dV(this,aq,"f")&&this._emit("toolCallDone",dV(this,aq,"f")),dW(this,ap,a.index,"f"),dW(this,aq,b.step_details.tool_calls[a.index],"f"),dV(this,aq,"f")&&this._emit("toolCallCreated",dV(this,aq,"f")));this._emit("runStepDelta",a.data.delta,b);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":dW(this,at,void 0,"f"),"tool_calls"==a.data.step_details.type&&dV(this,aq,"f")&&(this._emit("toolCallDone",dV(this,aq,"f")),dW(this,aq,void 0,"f")),this._emit("runStepDone",a.data,b)}},ay=function(a){dV(this,ai,"f").push(a),this._emit("event",a)},az=function(a){switch(a.event){case"thread.run.step.created":return dV(this,aj,"f")[a.data.id]=a.data,a.data;case"thread.run.step.delta":let b=dV(this,aj,"f")[a.data.id];if(!b)throw Error("Received a RunStepDelta before creation of a snapshot");let c=a.data;if(c.delta){let d=dX.accumulateDelta(b,c.delta);dV(this,aj,"f")[a.data.id]=d}return dV(this,aj,"f")[a.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":dV(this,aj,"f")[a.data.id]=a.data}if(dV(this,aj,"f")[a.data.id])return dV(this,aj,"f")[a.data.id];throw Error("No snapshot available")},aA=function(a,b){let c=[];switch(a.event){case"thread.message.created":return[a.data,c];case"thread.message.delta":if(!b)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let d=a.data;if(d.delta.content)for(let a of d.delta.content)if(a.index in b.content){let c=b.content[a.index];b.content[a.index]=dV(this,ah,"m",aB).call(this,a,c)}else b.content[a.index]=a,c.push(a);return[b,c];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(b)return[b,c];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},aB=function(a,b){return dX.accumulateDelta(b,a)},aC=function(a){switch(dW(this,as,a.data,"f"),a.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":dW(this,am,a.data,"f"),dV(this,aq,"f")&&(this._emit("toolCallDone",dV(this,aq,"f")),dW(this,aq,void 0,"f"))}};class dY extends cM{create(a,b,c){return this._client.post(`/threads/${a}/messages`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}retrieve(a,b,c){return this._client.get(`/threads/${a}/messages/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}update(a,b,c,d){return this._client.post(`/threads/${a}/messages/${b}`,{body:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}list(a,b={},c){return ct(b)?this.list(a,{},b):this._client.getAPIList(`/threads/${a}/messages`,dZ,{query:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}del(a,b,c){return this._client.delete(`/threads/${a}/messages/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}}class dZ extends cQ{}dY.MessagesPage=dZ;class d$ extends cM{retrieve(a,b,c,d={},e){return ct(d)?this.retrieve(a,b,c,{},d):this._client.get(`/threads/${a}/runs/${b}/steps/${c}`,{query:d,...e,headers:{"OpenAI-Beta":"assistants=v2",...e?.headers}})}list(a,b,c={},d){return ct(c)?this.list(a,b,{},c):this._client.getAPIList(`/threads/${a}/runs/${b}/steps`,d_,{query:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}}class d_ extends cQ{}d$.RunStepsPage=d_;class d0 extends cM{constructor(){super(...arguments),this.steps=new d$(this._client)}create(a,b,c){let{include:d,...e}=b;return this._client.post(`/threads/${a}/runs`,{query:{include:d},body:e,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers},stream:b.stream??!1})}retrieve(a,b,c){return this._client.get(`/threads/${a}/runs/${b}`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}update(a,b,c,d){return this._client.post(`/threads/${a}/runs/${b}`,{body:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers}})}list(a,b={},c){return ct(b)?this.list(a,{},b):this._client.getAPIList(`/threads/${a}/runs`,d1,{query:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}cancel(a,b,c){return this._client.post(`/threads/${a}/runs/${b}/cancel`,{...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}async createAndPoll(a,b,c){let d=await this.create(a,b,c);return await this.poll(a,d.id,c)}createAndStream(a,b,c){return dX.createAssistantStream(a,this._client.beta.threads.runs,b,c)}async poll(a,b,c){let d={...c?.headers,"X-Stainless-Poll-Helper":"true"};for(c?.pollIntervalMs&&(d["X-Stainless-Custom-Poll-Interval"]=c.pollIntervalMs.toString());;){let{data:e,response:f}=await this.retrieve(a,b,{...c,headers:{...c?.headers,...d}}).withResponse();switch(e.status){case"queued":case"in_progress":case"cancelling":let g=5e3;if(c?.pollIntervalMs)g=c.pollIntervalMs;else{let a=f.headers.get("openai-poll-after-ms");if(a){let b=parseInt(a);isNaN(b)||(g=b)}}await cA(g);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return e}}}stream(a,b,c){return dX.createAssistantStream(a,this._client.beta.threads.runs,b,c)}submitToolOutputs(a,b,c,d){return this._client.post(`/threads/${a}/runs/${b}/submit_tool_outputs`,{body:c,...d,headers:{"OpenAI-Beta":"assistants=v2",...d?.headers},stream:c.stream??!1})}async submitToolOutputsAndPoll(a,b,c,d){let e=await this.submitToolOutputs(a,b,c,d);return await this.poll(a,e.id,d)}submitToolOutputsStream(a,b,c,d){return dX.createToolAssistantStream(a,b,this._client.beta.threads.runs,c,d)}}class d1 extends cQ{}d0.RunsPage=d1,d0.Steps=d$,d0.RunStepsPage=d_;class d2 extends cM{constructor(){super(...arguments),this.runs=new d0(this._client),this.messages=new dY(this._client)}create(a={},b){return ct(a)?this.create({},a):this._client.post("/threads",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}retrieve(a,b){return this._client.get(`/threads/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}update(a,b,c){return this._client.post(`/threads/${a}`,{body:b,...c,headers:{"OpenAI-Beta":"assistants=v2",...c?.headers}})}del(a,b){return this._client.delete(`/threads/${a}`,{...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers}})}createAndRun(a,b){return this._client.post("/threads/runs",{body:a,...b,headers:{"OpenAI-Beta":"assistants=v2",...b?.headers},stream:a.stream??!1})}async createAndRunPoll(a,b){let c=await this.createAndRun(a,b);return await this.runs.poll(c.thread_id,c.id,b)}createAndRunStream(a,b){return dX.createThreadAssistantStream(a,this._client.beta.threads,b)}}d2.Runs=d0,d2.RunsPage=d1,d2.Messages=dY,d2.MessagesPage=dZ;class d3 extends cM{constructor(){super(...arguments),this.realtime=new dU(this._client),this.chat=new dR(this._client),this.assistants=new dr(this._client),this.threads=new d2(this._client)}}d3.Realtime=dU,d3.Assistants=dr,d3.AssistantsPage=ds,d3.Threads=d2;class d4 extends cM{create(a,b){return this._client.post("/batches",{body:a,...b})}retrieve(a,b){return this._client.get(`/batches/${a}`,b)}list(a={},b){return ct(a)?this.list({},a):this._client.getAPIList("/batches",d5,{query:a,...b})}cancel(a,b){return this._client.post(`/batches/${a}/cancel`,b)}}class d5 extends cQ{}d4.BatchesPage=d5;class d6 extends cM{create(a,b,c){return this._client.post(`/uploads/${a}/parts`,cf({body:b,...c}))}}class d7 extends cM{constructor(){super(...arguments),this.parts=new d6(this._client)}create(a,b){return this._client.post("/uploads",{body:a,...b})}cancel(a,b){return this._client.post(`/uploads/${a}/cancel`,b)}complete(a,b,c){return this._client.post(`/uploads/${a}/complete`,{body:b,...c})}}function d8(a,b){let c=a.output.map(a=>{if("function_call"===a.type)return{...a,parsed_arguments:function(a,b){var c,d;let e=(c=a.tools??[],d=b.name,c.find(a=>"function"===a.type&&a.name===d));return{...b,...b,parsed_arguments:e?.$brand==="auto-parseable-tool"?e.$parseRaw(b.arguments):e?.strict?JSON.parse(b.arguments):null}}(b,a)};if("message"===a.type){let c=a.content.map(a=>{var c,d;return"output_text"===a.type?{...a,parsed:(c=b,d=a.text,c.text?.format?.type!=="json_schema"?null:"$parseRaw"in c.text?.format?(c.text?.format).$parseRaw(d):JSON.parse(d))}:a});return{...a,content:c}}return a}),d=Object.assign({},a,{output:c});return Object.getOwnPropertyDescriptor(a,"output_text")||d9(d),Object.defineProperty(d,"output_parsed",{enumerable:!0,get(){for(let a of d.output)if("message"===a.type){for(let b of a.content)if("output_text"===b.type&&null!==b.parsed)return b.parsed}return null}}),d}function d9(a){let b=[];for(let c of a.output)if("message"===c.type)for(let a of c.content)"output_text"===a.type&&b.push(a.text);a.output_text=b.join("")}d7.Parts=d6;class ea extends cM{list(a,b={},c){return ct(b)?this.list(a,{},b):this._client.getAPIList(`/responses/${a}/input_items`,ef,{query:b,...c})}}var eb=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},ec=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class ed extends dz{constructor(a){super(),aD.add(this),aE.set(this,void 0),aF.set(this,void 0),aG.set(this,void 0),eb(this,aE,a,"f")}static createResponse(a,b,c){let d=new ed(b);return d._run(()=>d._createOrRetrieveResponse(a,b,{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),d}async _createOrRetrieveResponse(a,b,c){let d,e=c?.signal;e&&(e.aborted&&this.controller.abort(),e.addEventListener("abort",()=>this.controller.abort())),ec(this,aD,"m",aH).call(this);let f=null;for await(let e of("response_id"in b?(d=await a.responses.retrieve(b.response_id,{stream:!0},{...c,signal:this.controller.signal,stream:!0}),f=b.starting_after??null):d=await a.responses.create({...b,stream:!0},{...c,signal:this.controller.signal}),this._connected(),d))ec(this,aD,"m",aI).call(this,e,f);if(d.controller.signal?.aborted)throw new bN;return ec(this,aD,"m",aJ).call(this)}[(aE=new WeakMap,aF=new WeakMap,aG=new WeakMap,aD=new WeakSet,aH=function(){this.ended||eb(this,aF,void 0,"f")},aI=function(a,b){if(this.ended)return;let c=(a,c)=>{(null==b||c.sequence_number>b)&&this._emit(a,c)},d=ec(this,aD,"m",aK).call(this,a);switch(c("event",a),a.type){case"response.output_text.delta":{let b=d.output[a.output_index];if(!b)throw new bL(`missing output at index ${a.output_index}`);if("message"===b.type){let d=b.content[a.content_index];if(!d)throw new bL(`missing content at index ${a.content_index}`);if("output_text"!==d.type)throw new bL(`expected content to be 'output_text', got ${d.type}`);c("response.output_text.delta",{...a,snapshot:d.text})}break}case"response.function_call_arguments.delta":{let b=d.output[a.output_index];if(!b)throw new bL(`missing output at index ${a.output_index}`);"function_call"===b.type&&c("response.function_call_arguments.delta",{...a,snapshot:b.arguments});break}default:c(a.type,a)}},aJ=function(){if(this.ended)throw new bL("stream has ended, this shouldn't happen");let a=ec(this,aF,"f");if(!a)throw new bL("request ended without sending any events");eb(this,aF,void 0,"f");let b=function(a,b){var c;return b&&(c=b,dA(c.text?.format))?d8(a,b):{...a,output_parsed:null,output:a.output.map(a=>"function_call"===a.type?{...a,parsed_arguments:null}:"message"===a.type?{...a,content:a.content.map(a=>({...a,parsed:null}))}:a)}}(a,ec(this,aE,"f"));return eb(this,aG,b,"f"),b},aK=function(a){let b=ec(this,aF,"f");if(!b){if("response.created"!==a.type)throw new bL(`When snapshot hasn't been set yet, expected 'response.created' event, got ${a.type}`);return eb(this,aF,a.response,"f")}switch(a.type){case"response.output_item.added":b.output.push(a.item);break;case"response.content_part.added":{let c=b.output[a.output_index];if(!c)throw new bL(`missing output at index ${a.output_index}`);"message"===c.type&&c.content.push(a.part);break}case"response.output_text.delta":{let c=b.output[a.output_index];if(!c)throw new bL(`missing output at index ${a.output_index}`);if("message"===c.type){let b=c.content[a.content_index];if(!b)throw new bL(`missing content at index ${a.content_index}`);if("output_text"!==b.type)throw new bL(`expected content to be 'output_text', got ${b.type}`);b.text+=a.delta}break}case"response.function_call_arguments.delta":{let c=b.output[a.output_index];if(!c)throw new bL(`missing output at index ${a.output_index}`);"function_call"===c.type&&(c.arguments+=a.delta);break}case"response.completed":eb(this,aF,a.response,"f")}return b},Symbol.asyncIterator)](){let a=[],b=[],c=!1;return this.on("event",c=>{let d=b.shift();d?d.resolve(c):a.push(c)}),this.on("end",()=>{for(let a of(c=!0,b))a.resolve(void 0);b.length=0}),this.on("abort",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),this.on("error",a=>{for(let d of(c=!0,b))d.reject(a);b.length=0}),{next:async()=>a.length?{value:a.shift(),done:!1}:c?{value:void 0,done:!0}:new Promise((a,c)=>b.push({resolve:a,reject:c})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let a=ec(this,aG,"f");if(!a)throw new bL("stream ended without producing a ChatCompletion");return a}}class ee extends cM{constructor(){super(...arguments),this.inputItems=new ea(this._client)}create(a,b){return this._client.post("/responses",{body:a,...b,stream:a.stream??!1})._thenUnwrap(a=>("object"in a&&"response"===a.object&&d9(a),a))}retrieve(a,b={},c){return this._client.get(`/responses/${a}`,{query:b,...c,stream:b?.stream??!1})}del(a,b){return this._client.delete(`/responses/${a}`,{...b,headers:{Accept:"*/*",...b?.headers}})}parse(a,b){return this._client.responses.create(a,b)._thenUnwrap(b=>d8(b,a))}stream(a,b){return ed.createResponse(this._client,a,b)}cancel(a,b){return this._client.post(`/responses/${a}/cancel`,{...b,headers:{Accept:"*/*",...b?.headers}})}}class ef extends cQ{}ee.InputItems=ea;class eg extends cM{retrieve(a,b,c,d){return this._client.get(`/evals/${a}/runs/${b}/output_items/${c}`,d)}list(a,b,c={},d){return ct(c)?this.list(a,b,{},c):this._client.getAPIList(`/evals/${a}/runs/${b}/output_items`,eh,{query:c,...d})}}class eh extends cQ{}eg.OutputItemListResponsesPage=eh;class ei extends cM{constructor(){super(...arguments),this.outputItems=new eg(this._client)}create(a,b,c){return this._client.post(`/evals/${a}/runs`,{body:b,...c})}retrieve(a,b,c){return this._client.get(`/evals/${a}/runs/${b}`,c)}list(a,b={},c){return ct(b)?this.list(a,{},b):this._client.getAPIList(`/evals/${a}/runs`,ej,{query:b,...c})}del(a,b,c){return this._client.delete(`/evals/${a}/runs/${b}`,c)}cancel(a,b,c){return this._client.post(`/evals/${a}/runs/${b}`,c)}}class ej extends cQ{}ei.RunListResponsesPage=ej,ei.OutputItems=eg,ei.OutputItemListResponsesPage=eh;class ek extends cM{constructor(){super(...arguments),this.runs=new ei(this._client)}create(a,b){return this._client.post("/evals",{body:a,...b})}retrieve(a,b){return this._client.get(`/evals/${a}`,b)}update(a,b,c){return this._client.post(`/evals/${a}`,{body:b,...c})}list(a={},b){return ct(a)?this.list({},a):this._client.getAPIList("/evals",el,{query:a,...b})}del(a,b){return this._client.delete(`/evals/${a}`,b)}}class el extends cQ{}ek.EvalListResponsesPage=el,ek.Runs=ei,ek.RunListResponsesPage=ej;class em extends cM{retrieve(a,b,c){return this._client.get(`/containers/${a}/files/${b}/content`,{...c,headers:{Accept:"application/binary",...c?.headers},__binaryResponse:!0})}}class en extends cM{constructor(){super(...arguments),this.content=new em(this._client)}create(a,b,c){return this._client.post(`/containers/${a}/files`,cf({body:b,...c}))}retrieve(a,b,c){return this._client.get(`/containers/${a}/files/${b}`,c)}list(a,b={},c){return ct(b)?this.list(a,{},b):this._client.getAPIList(`/containers/${a}/files`,eo,{query:b,...c})}del(a,b,c){return this._client.delete(`/containers/${a}/files/${b}`,{...c,headers:{Accept:"*/*",...c?.headers}})}}class eo extends cQ{}en.FileListResponsesPage=eo,en.Content=em;class ep extends cM{constructor(){super(...arguments),this.files=new en(this._client)}create(a,b){return this._client.post("/containers",{body:a,...b})}retrieve(a,b){return this._client.get(`/containers/${a}`,b)}list(a={},b){return ct(a)?this.list({},a):this._client.getAPIList("/containers",eq,{query:a,...b})}del(a,b){return this._client.delete(`/containers/${a}`,{...b,headers:{Accept:"*/*",...b?.headers}})}}class eq extends cQ{}ep.ContainerListResponsesPage=eq,ep.Files=en,ep.FileListResponsesPage=eo;class er extends co{constructor({baseURL:a=cD("OPENAI_BASE_URL"),apiKey:b=cD("OPENAI_API_KEY"),organization:c=cD("OPENAI_ORG_ID")??null,project:d=cD("OPENAI_PROJECT_ID")??null,...e}={}){if(void 0===b)throw new bL("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let f={apiKey:b,organization:c,project:d,...e,baseURL:a||"https://api.openai.com/v1"};if(!f.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new bL("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:f.baseURL,timeout:f.timeout??6e5,httpAgent:f.httpAgent,maxRetries:f.maxRetries,fetch:f.fetch}),this.completions=new cN(this),this.chat=new cU(this),this.embeddings=new cV(this),this.files=new cW(this),this.images=new cY(this),this.audio=new c0(this),this.moderations=new c1(this),this.models=new c2(this),this.fineTuning=new df(this),this.graders=new dh(this),this.vectorStores=new dn(this),this.beta=new d3(this),this.batches=new d4(this),this.uploads=new d7(this),this.responses=new ee(this),this.evals=new ek(this),this.containers=new ep(this),this._options=f,this.apiKey=b,this.organization=c,this.project=d}defaultQuery(){return this._options.defaultQuery}defaultHeaders(a){return{...super.defaultHeaders(a),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(a){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(a){return function(a,b={}){let c,d=a,e=function(a=bc){let b;if(void 0!==a.allowEmptyArrays&&"boolean"!=typeof a.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==a.encodeDotInKeys&&"boolean"!=typeof a.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==a.encoder&&void 0!==a.encoder&&"function"!=typeof a.encoder)throw TypeError("Encoder has to be a function.");let c=a.charset||bc.charset;if(void 0!==a.charset&&"utf-8"!==a.charset&&"iso-8859-1"!==a.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let d=a1;if(void 0!==a.format){if(!a6.call(a2,a.format))throw TypeError("Unknown format option provided.");d=a.format}let e=a2[d],f=bc.filter;if(("function"==typeof a.filter||a8(a.filter))&&(f=a.filter),b=a.arrayFormat&&a.arrayFormat in a7?a.arrayFormat:"indices"in a?a.indices?"indices":"repeat":bc.arrayFormat,"commaRoundTrip"in a&&"boolean"!=typeof a.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let g=void 0===a.allowDots?!0==!!a.encodeDotInKeys||bc.allowDots:!!a.allowDots;return{addQueryPrefix:"boolean"==typeof a.addQueryPrefix?a.addQueryPrefix:bc.addQueryPrefix,allowDots:g,allowEmptyArrays:"boolean"==typeof a.allowEmptyArrays?!!a.allowEmptyArrays:bc.allowEmptyArrays,arrayFormat:b,charset:c,charsetSentinel:"boolean"==typeof a.charsetSentinel?a.charsetSentinel:bc.charsetSentinel,commaRoundTrip:!!a.commaRoundTrip,delimiter:void 0===a.delimiter?bc.delimiter:a.delimiter,encode:"boolean"==typeof a.encode?a.encode:bc.encode,encodeDotInKeys:"boolean"==typeof a.encodeDotInKeys?a.encodeDotInKeys:bc.encodeDotInKeys,encoder:"function"==typeof a.encoder?a.encoder:bc.encoder,encodeValuesOnly:"boolean"==typeof a.encodeValuesOnly?a.encodeValuesOnly:bc.encodeValuesOnly,filter:f,format:d,formatter:e,serializeDate:"function"==typeof a.serializeDate?a.serializeDate:bc.serializeDate,skipNulls:"boolean"==typeof a.skipNulls?a.skipNulls:bc.skipNulls,sort:"function"==typeof a.sort?a.sort:null,strictNullHandling:"boolean"==typeof a.strictNullHandling?a.strictNullHandling:bc.strictNullHandling}}(b);"function"==typeof e.filter?d=(0,e.filter)("",d):a8(e.filter)&&(c=e.filter);let f=[];if("object"!=typeof d||null===d)return"";let g=a7[e.arrayFormat],h="comma"===g&&e.commaRoundTrip;c||(c=Object.keys(d)),e.sort&&c.sort(e.sort);let i=new WeakMap;for(let a=0;a<c.length;++a){let b=c[a];e.skipNulls&&null===d[b]||ba(f,function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t,u;let v,w=b,x=s,y=0,z=!1;for(;void 0!==(x=x.get(bd))&&!z;){let a=x.get(b);if(y+=1,void 0!==a)if(a===y)throw RangeError("Cyclic object value");else z=!0;void 0===x.get(bd)&&(y=0)}if("function"==typeof k?w=k(c,w):w instanceof Date?w=n?.(w):"comma"===d&&a8(w)&&(w=a5(w,function(a){return a instanceof Date?n?.(a):a})),null===w){if(g)return j&&!q?j(c,bc.encoder,r,"key",o):c;w=""}if("string"==typeof(t=w)||"number"==typeof t||"boolean"==typeof t||"symbol"==typeof t||"bigint"==typeof t||(u=w)&&"object"==typeof u&&u.constructor&&u.constructor.isBuffer&&u.constructor.isBuffer(u)){if(j){let a=q?c:j(c,bc.encoder,r,"key",o);return[p?.(a)+"="+p?.(j(w,bc.encoder,r,"value",o))]}return[p?.(c)+"="+p?.(String(w))]}let A=[];if(void 0===w)return A;if("comma"===d&&a8(w))q&&j&&(w=a5(w,j)),v=[{value:w.length>0?w.join(",")||null:void 0}];else if(a8(k))v=k;else{let a=Object.keys(w);v=l?a.sort(l):a}let B=i?String(c).replace(/\./g,"%2E"):String(c),C=e&&a8(w)&&1===w.length?B+"[]":B;if(f&&a8(w)&&0===w.length)return C+"[]";for(let c=0;c<v.length;++c){let t=v[c],u="object"==typeof t&&void 0!==t.value?t.value:w[t];if(h&&null===u)continue;let x=m&&i?t.replace(/\./g,"%2E"):t,z=a8(w)?"function"==typeof d?d(C,x):C:C+(m?"."+x:"["+x+"]");s.set(b,y);let B=new WeakMap;B.set(bd,s),ba(A,a(u,z,d,e,f,g,h,i,"comma"===d&&q&&a8(w)?null:j,k,l,m,n,o,p,q,r,B))}return A}(d[b],b,g,h,e.allowEmptyArrays,e.strictNullHandling,e.skipNulls,e.encodeDotInKeys,e.encode?e.encoder:null,e.filter,e.sort,e.allowDots,e.serializeDate,e.format,e.formatter,e.encodeValuesOnly,e.charset,i))}let j=f.join(e.delimiter),k=!0===e.addQueryPrefix?"?":"";return e.charsetSentinel&&("iso-8859-1"===e.charset?k+="utf8=%26%2310003%3B&":k+="utf8=%E2%9C%93&"),j.length>0?k+j:""}(a,{arrayFormat:"brackets"})}}er.OpenAI=er,er.DEFAULT_TIMEOUT=6e5,er.OpenAIError=bL,er.APIError=bM,er.APIConnectionError=bO,er.APIConnectionTimeoutError=bP,er.APIUserAbortError=bN,er.NotFoundError=bT,er.ConflictError=bU,er.RateLimitError=bW,er.BadRequestError=bQ,er.AuthenticationError=bR,er.InternalServerError=bX,er.PermissionDeniedError=bS,er.UnprocessableEntityError=bV,er.toFile=ca,er.fileFromPath=l,er.Completions=cN,er.Chat=cU,er.ChatCompletionsPage=cS,er.Embeddings=cV,er.Files=cW,er.FileObjectsPage=cX,er.Images=cY,er.Audio=c0,er.Moderations=c1,er.Models=c2,er.ModelsPage=c3,er.FineTuning=df,er.Graders=dh,er.VectorStores=dn,er.VectorStoresPage=dp,er.VectorStoreSearchResponsesPage=dq,er.Beta=d3,er.Batches=d4,er.BatchesPage=d5,er.Uploads=d7,er.Responses=ee,er.Evals=ek,er.EvalListResponsesPage=el,er.Containers=ep,er.ContainerListResponsesPage=eq;var es=c(71873),et=c(96330);let eu=new er({apiKey:process.env.OPENAI_API_KEY}),ev=new et.PrismaClient;async function ew(a){try{let{message:b,stage:c="greeting",context:d={}}=await a.json();if(console.log("\uD83D\uDD0D AI Request:",{message:b,stage:c,context:d}),await new Promise(a=>setTimeout(a,5e3)),"greeting"===c||!d.conversationStarted)return a0.NextResponse.json({response:`Hi there! I'm Arian, your car detailing concierge. I can help you schedule appointments, check availability, and answer questions about our services. 

What can I help you with today?`,nextStage:"service_inquiry",context:{...d,conversationStarted:!0}});if("time_selection"===c&&d.availableSlots){let a=function(a){let b=a.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm|AM|PM)?/i);if(b){let a=parseInt(b[1]),c=b[2]?parseInt(b[2]):0,d=b[3]?.toLowerCase();return"pm"===d&&12!==a&&(a+=12),"am"===d&&12===a&&(a=0),new Date(2024,0,1,a,c).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}return null}(b);if(console.log("\uD83D\uDD50 Extracted time:",a),console.log(" Available slots:",d.availableSlots),!a)return console.log("❌ Time not recognized"),a0.NextResponse.json({response:`I didn't catch that time. Here are the available slots again: ${d.availableSlots.join(", ")}. Please choose one of these times.`,nextStage:"time_selection",context:{...d}});if(!d.availableSlots.includes(a))return console.log("❌ Time not available"),a0.NextResponse.json({response:`I'm sorry, ${a} is not available. Here are the available slots: ${d.availableSlots.join(", ")}. Please choose one of these times.`,nextStage:"time_selection",context:{...d}});console.log("✅ Time is available, creating booking...");try{let b=await ez({businessId:d.businessId||"689e47ec6df928b450daa9c0",customerName:d.customerName||"Customer",customerPhone:d.customerPhone||"",vehicleType:d.vehicleType||"Car",serviceType:"Interior Detail",date:d.selectedDate,time:a,duration:60,notes:d.notes||""});if(b.success)return a0.NextResponse.json({response:`Perfect! Your appointment has been confirmed for ${d.selectedDate} at ${a}. You'll receive a confirmation shortly. Your booking ID is: ${b.bookingId}`,nextStage:"booking_confirmed",bookingId:b.bookingId,context:{...d,bookingCompleted:!0}});return a0.NextResponse.json({response:"I'm sorry, there was an issue creating your appointment. Please try again or contact us directly.",nextStage:"error",context:{...d,bookingError:!0}})}catch(a){return console.error("Booking creation error:",a),a0.NextResponse.json({response:"I'm sorry, there was an issue creating your appointment. Please try again.",nextStage:"error",context:{...d,bookingError:a.message}})}}if("time_selection"!==c&&(b.toLowerCase().includes("monday")||b.toLowerCase().includes("appointment")||b.toLowerCase().includes("schedule")||b.toLowerCase().includes("book")||b.toLowerCase().includes("next")||b.toLowerCase().includes("available")||b.toLowerCase().includes("august")||b.toLowerCase().includes("18"))){let a,c,e;console.log("\uD83D\uDCC5 Detected booking request"),b.toLowerCase().includes("august 18")||b.toLowerCase().includes("18th")||b.toLowerCase().includes("18")?(a=new Date("2025-08-18"),c="2025-08-18",e="August 18th, 2025",console.log("\uD83D\uDCC5 User requested specific date: August 18th")):b.toLowerCase().includes("monday")?(c=(a=ex()).toISOString().split("T")[0],e=a.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),console.log("\uD83D\uDCC5 Using next Monday:",c)):(c=(a=ex()).toISOString().split("T")[0],e=a.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),console.log("\uD83D\uDCC5 Using next Monday (default):",c)),console.log("\uD83D\uDCC5 Checking availability for:",c),console.log("\uD83D\uDCC5 Display date will be:",e);try{let a=await ey(d.businessId||"689e47ec6df928b450daa9c0",c);console.log("✅ Availability check successful:",a);let b=a.timeSlots.filter(a=>a.available).map(a=>new Date(a.start).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}));if(console.log(" Available slots:",b),0===b.length)return a0.NextResponse.json({response:`I apologize, but we don't have any available time slots for ${e}. Would you like to check availability for another day?`,nextStage:"availability_check",context:{...d,lastCheckedDate:c}});return a0.NextResponse.json({response:`Great! I can see we have availability for ${e}. Here are the available time slots:

${b.join(", ")}

What time would you prefer for your appointment?`,nextStage:"time_selection",action:"show_availability",data:{date:c,availableSlots:b},context:{...d,availableSlots:b,selectedDate:c}})}catch(a){return console.error("❌ Calendar availability error:",a),a0.NextResponse.json({response:`I'm having trouble checking our availability right now. Error: ${a.message}. Could you please try again in a moment?`,nextStage:"error",context:{...d,lastError:a.message}})}}let e=await eu.chat.completions.create({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are Arian, a professional car detailing concierge. Be helpful, friendly, and professional. If someone wants to book an appointment, ask them to specify a date and time. Keep responses concise and focused. Always refer to yourself as Arian."},{role:"user",content:b}],max_tokens:150});return a0.NextResponse.json({response:e.choices[0].message.content||"I'm sorry, I didn't understand that. Could you please rephrase?",context:{...d}})}catch(a){return console.error("❌ AI conversation error:",a),a0.NextResponse.json({response:`I'm sorry, I'm having trouble right now. Error: ${a.message}. Please try again.`,nextStage:"error"},{status:500})}}function ex(){let a=new Date;console.log("\uD83D\uDCC5 Today is:",a.toDateString());let b=a.getDay(),c=1-b;1===b?c=7:b>1&&(c=8-b);let d=new Date(a);return d.setDate(a.getDate()+c),console.log("\uD83D\uDCC5 Next Monday is:",d.toDateString()),d}async function ey(a,b){console.log("\uD83D\uDD0D Starting availability check for business:",a,"date:",b);try{let c=await ev.business.findUnique({where:{id:a}});if(console.log("\uD83C\uDFE2 Business found:",c?"Yes":"No"),console.log("\uD83D\uDD11 Has access token:",!!c?.gcalAccessToken),!c?.gcalAccessToken)throw Error("Business not found or Google Calendar not connected");let d=new es.q7g.auth.OAuth2;d.setCredentials({access_token:c.gcalAccessToken,refresh_token:c.gcalRefreshToken});let e=es.q7g.calendar({version:"v3",auth:d}),f=new Date(b+"T00:00:00-04:00"),g=new Date(b+"T23:59:59-04:00");console.log("\uD83D\uDCC5 Fetching calendar events from:",f.toISOString(),"to:",g.toISOString());let h=(await e.events.list({calendarId:"primary",timeMin:f.toISOString(),timeMax:g.toISOString(),singleEvents:!0,orderBy:"startTime",maxResults:50})).data.items||[];console.log("\uD83D\uDCC5 Found events:",h.length);let i=[];for(let a=9;a<18;a++){let c=new Date(b+`T${a.toString().padStart(2,"0")}:00:00-04:00`),d=new Date(b+`T${(a+1).toString().padStart(2,"0")}:00:00-04:00`),e=h.some(a=>{let b=new Date(a.start?.dateTime||a.start?.date||""),e=new Date(a.end?.dateTime||a.end?.date||"");return c<e&&d>b});i.push({start:c,end:d,available:!e})}return console.log(" Created time slots:",i.length),{businessId:a,date:b,timeSlots:i}}catch(a){if(console.error("❌ Calendar availability check error:",a),a.message.includes("invalid_request")||a.message.includes("unauthorized"))throw Error("Google Calendar access expired. Please re-authenticate.");throw a}}async function ez(a){try{console.log("\uD83D\uDCDD Creating booking:",a);let b=await ev.business.findUnique({where:{id:a.businessId}});if(!b?.gcalAccessToken)throw Error("Business not found or Google Calendar not connected");let c=new es.q7g.auth.OAuth2;c.setCredentials({access_token:b.gcalAccessToken,refresh_token:b.gcalRefreshToken});let d=es.q7g.calendar({version:"v3",auth:c}),e=a.time.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!e)throw Error("Invalid time format");let f=parseInt(e[1]),g=parseInt(e[2]),h=e[3].toLowerCase();"pm"===h&&12!==f&&(f+=12),"am"===h&&12===f&&(f=0);let i=new Date(`${a.date}T${f.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}:00-04:00`),j=new Date(i.getTime()+6e4*a.duration);console.log("\uD83D\uDCC5 Event start:",i.toISOString()),console.log("\uD83D\uDCC5 Event end:",j.toISOString());let k={summary:`Car Detailing - ${a.customerName}`,description:`Service: ${a.serviceType}
Vehicle: ${a.vehicleType}
Phone: ${a.customerPhone}
Notes: ${a.notes||"None"}`,start:{dateTime:i.toISOString(),timeZone:"America/New_York"},end:{dateTime:j.toISOString(),timeZone:"America/New_York"}},l=await d.events.insert({calendarId:"primary",requestBody:k}),m=await ev.job.create({data:{businessId:a.businessId,customerName:a.customerName,customerPhone:a.customerPhone,customerEmail:a.customerEmail,vehicleType:a.vehicleType,serviceType:a.serviceType,service:a.serviceType,scheduledDate:i,duration:a.duration,status:"SCHEDULED",notes:a.notes,calendarEventId:l.data.id}});return console.log("✅ Booking created successfully:",m.id),{success:!0,bookingId:m.id,calendarEventId:l.data.id}}catch(a){return console.error("❌ Booking creation error:",a),{success:!1,message:a.message}}}let eA=new aM.AppRouteRouteModule({definition:{kind:aN.RouteKind.APP_ROUTE,page:"/api/ai/conversation/route",pathname:"/api/ai/conversation",filename:"route",bundlePath:"app/api/ai/conversation/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/abdulabbas/Library/Mobile Documents/com~apple~CloudDocs/ReevaCar/car-detailing/apps/web/app/api/ai/conversation/route.ts",nextConfigOutput:"",userland:aL}),{workAsyncStorage:eB,workUnitAsyncStorage:eC,serverHooks:eD}=eA;function eE(){return(0,aO.patchFetch)({workAsyncStorage:eB,workUnitAsyncStorage:eC})}async function eF(a,b,c){var d;let e="/api/ai/conversation/route";"/index"===e&&(e="/");let f=await eA.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,resolvedPathname:o}=f,p=(0,aR.normalizeAppPath)(e),q=!!(k.dynamicRoutes[p]||k.routes[o]);if(q&&!j){let a=!!k.routes[o],b=k.dynamicRoutes[p];if(b&&!1===b.fallback&&!a)throw new a$.NoFallbackError}let r=null;!q||eA.isDev||j||(r="/index"===(r=o)?"/":r);let s=!0===eA.isDev||!q,t=q&&!s,u=a.method||"GET",v=(0,aQ.getTracer)(),w=v.getActiveScopeSpan(),x={params:h,prerenderManifest:k,renderOpts:{experimental:{dynamicIO:!!i.experimental.dynamicIO,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:s,incrementalCache:(0,aP.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:t,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>eA.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},y=new aS.NodeNextRequest(a),z=new aS.NodeNextResponse(b),A=aT.NextRequestAdapter.fromNodeNextRequest(y,(0,aT.signalFromNodeResponse)(b));try{let d=async c=>eA.handle(A,x).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=v.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==aU.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${u} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${u} ${a.url}`)}),f=async f=>{var g,h;let o=async({previousCacheEntry:g})=>{try{if(!(0,aP.getRequestMeta)(a,"minimalMode")&&m&&n&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=x.renderOpts.fetchMetrics;let h=x.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=x.renderOpts.collectedTags;if(!q)return await (0,aW.I)(y,z,e,x.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,aX.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[aZ.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==x.renderOpts.collectedRevalidate&&!(x.renderOpts.collectedRevalidate>=aZ.INFINITE_CACHE)&&x.renderOpts.collectedRevalidate,d=void 0===x.renderOpts.collectedExpire||x.renderOpts.collectedExpire>=aZ.INFINITE_CACHE?void 0:x.renderOpts.collectedExpire;return{value:{kind:a_.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await eA.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,aV.c)({isRevalidate:t,isOnDemandRevalidate:m})},l),b}},p=await eA.handleResponse({req:a,nextConfig:i,cacheKey:r,routeKind:aN.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,responseGenerator:o,waitUntil:c.waitUntil});if(!q)return null;if((null==p||null==(g=p.value)?void 0:g.kind)!==a_.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(h=p.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,aP.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",m?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let s=(0,aX.fromNodeOutgoingHttpHeaders)(p.value.headers);return(0,aP.getRequestMeta)(a,"minimalMode")&&q||s.delete(aZ.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||b.getHeader("Cache-Control")||s.get("Cache-Control")||s.set("Cache-Control",(0,aY.getCacheControlHeader)(p.cacheControl)),await (0,aW.I)(y,z,new Response(p.value.body,{headers:s,status:p.value.status||200})),null};w?await f(w):await v.withPropagatedContext(a.headers,()=>v.trace(aU.BaseServerSpan.handleRequest,{spanName:`${u} ${a.url}`,kind:aQ.SpanKind.SERVER,attributes:{"http.method":u,"http.target":a.url}},f))}catch(b){if(w||b instanceof a$.NoFallbackError||await eA.onRequestError(a,b,{routerKind:"App Router",routePath:p,routeType:"route",revalidateReason:(0,aV.c)({isRevalidate:t,isOnDemandRevalidate:m})}),q)throw b;return await (0,aW.I)(y,z,new Response(null,{status:500})),null}}},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{"use strict";a.exports=require("querystring")},11997:a=>{"use strict";a.exports=require("punycode")},12412:a=>{"use strict";a.exports=require("assert")},14989:()=>{},18968:(a,b,c)=>{"use strict";let d=c(81630).Agent,e=c(19133),f=c(28354).debuglog("agentkeepalive"),{INIT_SOCKET:g,CURRENT_ID:h,CREATE_ID:i,SOCKET_CREATED_TIME:j,SOCKET_NAME:k,SOCKET_REQUEST_COUNT:l,SOCKET_REQUEST_FINISHED_COUNT:m}=c(34388),n=1,o=parseInt(process.version.split(".",1)[0].substring(1));function p(a){console.log("[agentkeepalive:deprecated] %s",a)}o>=11&&o<=12?n=2:o>=13&&(n=3);class q extends d{constructor(a){(a=a||{}).keepAlive=!1!==a.keepAlive,void 0===a.freeSocketTimeout&&(a.freeSocketTimeout=4e3),a.keepAliveTimeout&&(p("options.keepAliveTimeout is deprecated, please use options.freeSocketTimeout instead"),a.freeSocketTimeout=a.keepAliveTimeout,delete a.keepAliveTimeout),a.freeSocketKeepAliveTimeout&&(p("options.freeSocketKeepAliveTimeout is deprecated, please use options.freeSocketTimeout instead"),a.freeSocketTimeout=a.freeSocketKeepAliveTimeout,delete a.freeSocketKeepAliveTimeout),void 0===a.timeout&&(a.timeout=Math.max(2*a.freeSocketTimeout,8e3)),a.timeout=e(a.timeout),a.freeSocketTimeout=e(a.freeSocketTimeout),a.socketActiveTTL=a.socketActiveTTL?e(a.socketActiveTTL):0,super(a),this[h]=0,this.createSocketCount=0,this.createSocketCountLastCheck=0,this.createSocketErrorCount=0,this.createSocketErrorCountLastCheck=0,this.closeSocketCount=0,this.closeSocketCountLastCheck=0,this.errorSocketCount=0,this.errorSocketCountLastCheck=0,this.requestCount=0,this.requestCountLastCheck=0,this.timeoutSocketCount=0,this.timeoutSocketCountLastCheck=0,this.on("free",a=>{let b=this.calcSocketTimeout(a);b>0&&a.timeout!==b&&a.setTimeout(b)})}get freeSocketKeepAliveTimeout(){return p("agent.freeSocketKeepAliveTimeout is deprecated, please use agent.options.freeSocketTimeout instead"),this.options.freeSocketTimeout}get timeout(){return p("agent.timeout is deprecated, please use agent.options.timeout instead"),this.options.timeout}get socketActiveTTL(){return p("agent.socketActiveTTL is deprecated, please use agent.options.socketActiveTTL instead"),this.options.socketActiveTTL}calcSocketTimeout(a){let b=this.options.freeSocketTimeout,c=this.options.socketActiveTTL;if(c){let d=c-(Date.now()-a[j]);if(d<=0)return d;b&&d<b&&(b=d)}if(b)return a.freeSocketTimeout||a.freeSocketKeepAliveTimeout||b}keepSocketAlive(a){let b=super.keepSocketAlive(a);if(!b)return b;let c=this.calcSocketTimeout(a);return void 0===c||(c<=0?(f("%s(requests: %s, finished: %s) free but need to destroy by TTL, request count %s, diff is %s",a[k],a[l],a[m],c),!1):(a.timeout!==c&&a.setTimeout(c),!0))}reuseSocket(...a){super.reuseSocket(...a);let b=a[0];a[1].reusedSocket=!0;let c=this.options.timeout;r(b)!==c&&(b.setTimeout(c),f("%s reset timeout to %sms",b[k],c)),b[l]++,f("%s(requests: %s, finished: %s) reuse on addRequest, timeout %sms",b[k],b[l],b[m],r(b))}[i](){let a=this[h]++;return this[h]===Number.MAX_SAFE_INTEGER&&(this[h]=0),a}[g](a,b){b.timeout&&(r(a)||a.setTimeout(b.timeout)),this.options.keepAlive&&a.setNoDelay(!0),this.createSocketCount++,this.options.socketActiveTTL&&(a[j]=Date.now()),a[k]=`sock[${this[i]()}#${b._agentKey}]`.split("-----BEGIN",1)[0],a[l]=1,a[m]=0,function(a,b,c){function d(){if(!b._httpMessage&&1===b[l])return;b[m]++,a.requestCount++,f("%s(requests: %s, finished: %s) free",b[k],b[l],b[m]);let d=a.getName(c);b.writable&&a.requests[d]&&a.requests[d].length&&(b[l]++,f("%s(requests: %s, finished: %s) will be reuse on agent free event",b[k],b[l],b[m]))}function e(c){f("%s(requests: %s, finished: %s) close, isError: %s",b[k],b[l],b[m],c),a.closeSocketCount++}function g(){let d=b.listeners("timeout").length,e=r(b),g=b._httpMessage,h=g&&g.listeners("timeout").length||0;f("%s(requests: %s, finished: %s) timeout after %sms, listeners %s, defaultTimeoutListenerCount %s, hasHttpRequest %s, HttpRequest timeoutListenerCount %s",b[k],b[l],b[m],e,d,n,!!g,h),f.enabled&&f("timeout listeners: %s",b.listeners("timeout").map(a=>a.name).join(", ")),a.timeoutSocketCount++;let i=a.getName(c);if(a.freeSockets[i]&&-1!==a.freeSockets[i].indexOf(b))b.destroy(),a.removeSocket(b,c),f("%s is free, destroy quietly",b[k]);else if(0===h){let d=Error("Socket timeout");d.code="ERR_SOCKET_TIMEOUT",d.timeout=e,b.destroy(d),a.removeSocket(b,c),f("%s destroy with timeout error",b[k])}}function h(c){let d=b.listeners("error").length;f("%s(requests: %s, finished: %s) error: %s, listenerCount: %s",b[k],b[l],b[m],c,d),a.errorSocketCount++,1===d&&(f("%s emit uncaught error event",b[k]),b.removeListener("error",h),b.emit("error",c))}f("%s create, timeout %sms",b[k],r(b)),b.on("free",d),b.on("close",e),b.on("timeout",g),b.on("error",h),b.on("agentRemove",function a(){f("%s(requests: %s, finished: %s) agentRemove",b[k],b[l],b[m]),b.removeListener("close",e),b.removeListener("error",h),b.removeListener("free",d),b.removeListener("timeout",g),b.removeListener("agentRemove",a)})}(this,a,b)}createConnection(a,b){let c=!1,d=(d,e)=>{if(!c){if(c=!0,d)return this.createSocketErrorCount++,b(d);this[g](e,a),b(d,e)}},e=super.createConnection(a,d);return e&&d(null,e),e}get statusChanged(){let a=this.createSocketCount!==this.createSocketCountLastCheck||this.createSocketErrorCount!==this.createSocketErrorCountLastCheck||this.closeSocketCount!==this.closeSocketCountLastCheck||this.errorSocketCount!==this.errorSocketCountLastCheck||this.timeoutSocketCount!==this.timeoutSocketCountLastCheck||this.requestCount!==this.requestCountLastCheck;return a&&(this.createSocketCountLastCheck=this.createSocketCount,this.createSocketErrorCountLastCheck=this.createSocketErrorCount,this.closeSocketCountLastCheck=this.closeSocketCount,this.errorSocketCountLastCheck=this.errorSocketCount,this.timeoutSocketCountLastCheck=this.timeoutSocketCount,this.requestCountLastCheck=this.requestCount),a}getCurrentStatus(){return{createSocketCount:this.createSocketCount,createSocketErrorCount:this.createSocketErrorCount,closeSocketCount:this.closeSocketCount,errorSocketCount:this.errorSocketCount,timeoutSocketCount:this.timeoutSocketCount,requestCount:this.requestCount,freeSockets:s(this.freeSockets),sockets:s(this.sockets),requests:s(this.requests)}}}function r(a){return a.timeout||a._idleTimeout}function s(a){let b={};for(let c in a)b[c]=a[c].length;return b}a.exports=q},19133:(a,b,c)=>{"use strict";var d=c(28354),e=c(52819);a.exports=function(a){if("number"==typeof a)return a;var b=e(a);return void 0===b&&console.warn(Error(d.format("humanize-ms(%j) result undefined",a)).stack),b}},19771:a=>{"use strict";a.exports=require("process")},21820:a=>{"use strict";a.exports=require("os")},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32714:(a,b,c)=>{"use strict";c.d(b,{Z:()=>i});var d,e,f=c(4537),g=function(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c},h=function(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)};class i extends f.Y{constructor(a,b,c={}){if(super(a,c),d.set(this,void 0),e.set(this,0),arguments.length<2)throw TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);g(this,d,String(b),"f");let f=void 0===c.lastModified?Date.now():Number(c.lastModified);Number.isNaN(f)||g(this,e,f,"f")}static[(d=new WeakMap,e=new WeakMap,Symbol.hasInstance)](a){return a instanceof f.Y&&"File"===a[Symbol.toStringTag]&&"string"==typeof a.name}get name(){return h(this,d,"f")}get lastModified(){return h(this,e,"f")}get webkitRelativePath(){return""}get[Symbol.toStringTag](){return"File"}}},33873:a=>{"use strict";a.exports=require("path")},34388:a=>{"use strict";a.exports={CURRENT_ID:Symbol("agentkeepalive#currentId"),CREATE_ID:Symbol("agentkeepalive#createId"),INIT_SOCKET:Symbol("agentkeepalive#initSocket"),CREATE_HTTPS_CONNECTION:Symbol("agentkeepalive#createHttpsConnection"),SOCKET_CREATED_TIME:Symbol("agentkeepalive#socketCreatedTime"),SOCKET_NAME:Symbol("agentkeepalive#socketName"),SOCKET_REQUEST_COUNT:Symbol("agentkeepalive#socketRequestCount"),SOCKET_REQUEST_FINISHED_COUNT:Symbol("agentkeepalive#socketRequestFinishedCount")}},34631:a=>{"use strict";a.exports=require("tls")},39078:(a,b,c)=>{"use strict";c.d(b,{f:()=>e});var d=c(32714);let e=a=>a instanceof d.Z},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},53700:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});let c=new WeakMap,d=new WeakMap;function e(a){let b=c.get(a);return console.assert(null!=b,"'this' is expected an Event object, but got",a),b}function f(a){if(null!=a.passiveListener){"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",a.passiveListener);return}a.event.cancelable&&(a.canceled=!0,"function"==typeof a.event.preventDefault&&a.event.preventDefault())}function g(a,b){c.set(this,{eventTarget:a,event:b,eventPhase:2,currentTarget:a,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:b.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let d=Object.keys(b);for(let a=0;a<d.length;++a){let b=d[a];b in this||Object.defineProperty(this,b,h(b))}}function h(a){return{get(){return e(this).event[a]},set(b){e(this).event[a]=b},configurable:!0,enumerable:!0}}function i(a,b){e(a).passiveListener=b}g.prototype={get type(){return e(this).event.type},get target(){return e(this).eventTarget},get currentTarget(){return e(this).currentTarget},composedPath(){let a=e(this).currentTarget;return null==a?[]:[a]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return e(this).eventPhase},stopPropagation(){let a=e(this);a.stopped=!0,"function"==typeof a.event.stopPropagation&&a.event.stopPropagation()},stopImmediatePropagation(){let a=e(this);a.stopped=!0,a.immediateStopped=!0,"function"==typeof a.event.stopImmediatePropagation&&a.event.stopImmediatePropagation()},get bubbles(){return!!e(this).event.bubbles},get cancelable(){return!!e(this).event.cancelable},preventDefault(){f(e(this))},get defaultPrevented(){return e(this).canceled},get composed(){return!!e(this).event.composed},get timeStamp(){return e(this).timeStamp},get srcElement(){return e(this).eventTarget},get cancelBubble(){return e(this).stopped},set cancelBubble(value){if(!value)return;let a=e(this);a.stopped=!0,"boolean"==typeof a.event.cancelBubble&&(a.event.cancelBubble=!0)},get returnValue(){return!e(this).canceled},set returnValue(value){value||f(e(this))},initEvent(){}},Object.defineProperty(g.prototype,"constructor",{value:g,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(g.prototype,window.Event.prototype),d.set(window.Event.prototype,g));let j=new WeakMap;function k(a){return null!==a&&"object"==typeof a}function l(a){let b=j.get(a);if(null==b)throw TypeError("'this' is expected an EventTarget object, but got another value.");return b}function m(a,b){Object.defineProperty(a,`on${b}`,{get(){let a=l(this).get(b);for(;null!=a;){if(3===a.listenerType)return a.listener;a=a.next}return null},set(a){"function"==typeof a||k(a)||(a=null);let c=l(this),d=null,e=c.get(b);for(;null!=e;)3===e.listenerType?null!==d?d.next=e.next:null!==e.next?c.set(b,e.next):c.delete(b):d=e,e=e.next;if(null!==a){let e={listener:a,listenerType:3,passive:!1,once:!1,next:null};null===d?c.set(b,e):d.next=e}},configurable:!0,enumerable:!0})}function n(a){function b(){o.call(this)}b.prototype=Object.create(o.prototype,{constructor:{value:b,configurable:!0,writable:!0}});for(let c=0;c<a.length;++c)m(b.prototype,a[c]);return b}function o(){if(this instanceof o)return void j.set(this,new Map);if(1==arguments.length&&Array.isArray(arguments[0]))return n(arguments[0]);if(arguments.length>0){let a=Array(arguments.length);for(let b=0;b<arguments.length;++b)a[b]=arguments[b];return n(a)}throw TypeError("Cannot call a class as a function")}o.prototype={addEventListener(a,b,c){if(null==b)return;if("function"!=typeof b&&!k(b))throw TypeError("'listener' should be a function or an object.");let d=l(this),e=k(c),f=(e?c.capture:c)?1:2,g={listener:b,listenerType:f,passive:e&&!!c.passive,once:e&&!!c.once,next:null},h=d.get(a);if(void 0===h)return void d.set(a,g);let i=null;for(;null!=h;){if(h.listener===b&&h.listenerType===f)return;i=h,h=h.next}i.next=g},removeEventListener(a,b,c){if(null==b)return;let d=l(this),e=(k(c)?c.capture:c)?1:2,f=null,g=d.get(a);for(;null!=g;){if(g.listener===b&&g.listenerType===e)return void(null!==f?f.next=g.next:null!==g.next?d.set(a,g.next):d.delete(a));f=g,g=g.next}},dispatchEvent(a){if(null==a||"string"!=typeof a.type)throw TypeError('"event.type" should be a string.');let b=l(this),c=a.type,f=b.get(c);if(null==f)return!0;let j=new(function a(b){if(null==b||b===Object.prototype)return g;let c=d.get(b);return null==c&&(c=function(a,b){let c=Object.keys(b);if(0===c.length)return a;function d(b,c){a.call(this,b,c)}d.prototype=Object.create(a.prototype,{constructor:{value:d,configurable:!0,writable:!0}});for(let f=0;f<c.length;++f){let g=c[f];if(!(g in a.prototype)){let a="function"==typeof Object.getOwnPropertyDescriptor(b,g).value;Object.defineProperty(d.prototype,g,a?function(a){return{value(){let b=e(this).event;return b[a].apply(b,arguments)},configurable:!0,enumerable:!0}}(g):h(g))}}return d}(a(Object.getPrototypeOf(b)),b),d.set(b,c)),c}(Object.getPrototypeOf(a)))(this,a),k=null;for(;null!=f;){if(f.once?null!==k?k.next=f.next:null!==f.next?b.set(c,f.next):b.delete(c):k=f,i(j,f.passive?f.listener:null),"function"==typeof f.listener)try{f.listener.call(this,j)}catch(a){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(a)}else 3!==f.listenerType&&"function"==typeof f.listener.handleEvent&&f.listener.handleEvent(j);if(e(j).immediateStopped)break;f=f.next}return i(j,null),e(j).eventPhase=0,e(j).currentTarget=null,!j.defaultPrevented}},Object.defineProperty(o.prototype,"constructor",{value:o,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(o.prototype,window.EventTarget.prototype),b.defineEventAttribute=m,b.EventTarget=o,b.default=o,a.exports=o,a.exports.EventTarget=a.exports.default=o,a.exports.defineEventAttribute=m},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},57975:a=>{"use strict";a.exports=require("node:util")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67725:()=>{},71636:(a,b,c)=>{"use strict";c.d(b,{T:()=>d});let d=a=>"function"==typeof a},73496:a=>{"use strict";a.exports=require("http2")},73566:a=>{"use strict";a.exports=require("worker_threads")},74075:a=>{"use strict";a.exports=require("zlib")},78474:a=>{"use strict";a.exports=require("node:events")},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},79646:a=>{"use strict";a.exports=require("child_process")},81630:a=>{"use strict";a.exports=require("http")},83997:a=>{"use strict";a.exports=require("tty")},85725:(a,b,c)=>{"use strict";let d=c(18968);a.exports=d,a.exports.HttpAgent=d,a.exports.HttpsAgent=c(88382),a.exports.constants=c(34388)},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},88382:(a,b,c)=>{"use strict";let d=c(55591).Agent,e=c(18968),{INIT_SOCKET:f,CREATE_HTTPS_CONNECTION:g}=c(34388);class h extends e{constructor(a){super(a),this.defaultPort=443,this.protocol="https:",this.maxCachedSessions=this.options.maxCachedSessions,void 0===this.maxCachedSessions&&(this.maxCachedSessions=100),this._sessionCache={map:{},list:[]}}createConnection(a,b){let c=this[g](a,b);return this[f](c,a),c}}h.prototype[g]=d.prototype.createConnection,["getName","_getSession","_cacheSession","_evictSession"].forEach(function(a){"function"==typeof d.prototype[a]&&(h.prototype[a]=d.prototype[a])}),a.exports=h},91645:a=>{"use strict";a.exports=require("net")},94735:a=>{"use strict";a.exports=require("events")},95046:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(53700);class AbortSignal extends d.EventTarget{constructor(){throw super(),TypeError("AbortSignal cannot be constructed directly")}get aborted(){let a=e.get(this);if("boolean"!=typeof a)throw TypeError(`Expected 'this' to be an 'AbortSignal' object, but got ${this===null?"null":typeof this}`);return a}}d.defineEventAttribute(AbortSignal.prototype,"abort");let e=new WeakMap;Object.defineProperties(AbortSignal.prototype,{aborted:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(AbortSignal.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortSignal"});class f{constructor(){g.set(this,function(){let a=Object.create(AbortSignal.prototype);return d.EventTarget.call(a),e.set(a,!1),a}())}get signal(){return h(this)}abort(){var a;a=h(this),!1===e.get(a)&&(e.set(a,!0),a.dispatchEvent({type:"abort"}))}}let g=new WeakMap;function h(a){let b=g.get(a);if(null==b)throw TypeError(`Expected 'this' to be an 'AbortController' object, but got ${null===a?"null":typeof a}`);return b}Object.defineProperties(f.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}}),"function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(f.prototype,Symbol.toStringTag,{configurable:!0,value:"AbortController"}),b.AbortController=f,b.AbortSignal=AbortSignal,b.default=f,a.exports=f,a.exports.AbortController=a.exports.default=f,a.exports.AbortSignal=AbortSignal},96330:a=>{"use strict";a.exports=require("@prisma/client")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[59,841,873],()=>b(b.s=5231));module.exports=c})();